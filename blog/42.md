---
# ä¸»é¢˜åˆ—è¡¨ï¼šjuejin, github, smartblue, cyanosis, channing-cyan, fancy, hydrogen, condensed-night-purple, greenwillow, v-green, vue-pro, healer-readable, mk-cute
# è´¡çŒ®ä¸»é¢˜ï¼šhttps://github.com/xitu/juejin-markdown-themes
theme: channing-cyan
highlight: atom-one-dark
---
## å‰è¨€
**è™½ç„¶å•å…ƒæµ‹è¯•æ˜¯æš–æš–çš„ï¼Œä½†æ²¡äººç‚¹èµï¼Œæˆ‘çš„å¿ƒæ˜¯å†°å†°çš„**
<img src='https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4303b1dad7bb4199a9cf8c7b796b741f~tplv-k3u1fbpfcp-watermark.image' width=400>

æœ¬ç¯‡æ–‡ç« ä¸ºæ­¤æ¬¡VUEå•å…ƒæµ‹è¯•ä¹‹æ—…çš„â€œç»ˆç‚¹ç«™â€ï¼Œè¯·å„ä½ä¹˜å®¢æœ‰åºä¸‹è½¦å¹¶ç‚¹èµğŸ‘ï¼

æƒ³è¦æˆä¸º`VUE`å•å…ƒæµ‹è¯•çš„å¤§å¸ˆï¼Œæ€ä¹ˆå¯èƒ½å°‘çš„äº†`VUEX`çš„æµ‹è¯•ï¼è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯ä»‹ç»å¦‚ä½•å¯¹`vuex`å’Œ`mixin`å†™å•å…ƒæµ‹è¯•ã€‚

å¦‚æœè¿˜æœ‰å°ä¼™ä¼´è¿˜æ²¡å†™è¿‡å•å…ƒæµ‹è¯•ï¼Œè¯·ç§»æ­¥åˆ°æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼š
* [VUEå•å…ƒæµ‹è¯•--å¼€å¯æµ‹è¯•ä¹‹æ—…](https://juejin.cn/post/6906295144505409549)
* [VUEå•å…ƒæµ‹è¯•è¿›é˜¶](https://juejin.cn/post/6916677772962168845)

## æµ‹è¯•VUEX
å…¶å®æµ‹è¯•`VUEX`æ˜¯æœ‰ä¸¤ç§æ–¹æ³•ï¼š
* ç¬¬ä¸€ç§å°±æ˜¯å¯¹`VUEX`çš„`store`ç»„æˆéƒ¨åˆ†åˆ†åˆ«è¿›è¡Œæµ‹è¯•ã€‚
* ç¬¬äºŒç§å°±æ˜¯å°†å®ƒä»¬ç»„åˆåˆ°ä¸€ä¸ª`store`å®ä¾‹ä¸Šï¼Œç„¶åæµ‹è¯•è¯¥å®ä¾‹ã€‚

ç¬¬ä¸€ç§æ–¹æ³•çš„å¥½å¤„æ˜¯ç®€å•ï¼Œå› ä¸ºéƒ½æ˜¯`JavaScript`å‡½æ•°ã€‚æ‰€ä»¥ä¸‹é¢ä¸»è¦æ¥ä»‹ç»ä¸€ä¸‹ç¬¬äºŒç§æ–¹æ³•ï¼ˆå…¶å®ä¹ŸæŒºç®€å•çš„ï¼‰

å•å…ƒæµ‹è¯•ä¸»è¦æ˜¯æä¾›è¾“å…¥å’Œæ–­è¨€è¾“å‡ºã€‚åœ¨`VUEX`ä¸­çš„ä½“ç°å°±æ˜¯ï¼š`mutation`å’Œ`action`æ˜¯`store`çš„è¾“å…¥ï¼Œ`getter`å’Œ`state`æ˜¯`store`çš„è¾“å‡ºï¼Œè¿™æ ·çœ‹å°±å¾ˆæ¸…æ™°äº†ã€‚

å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š
```js
test('commit a increment, state.count well plus 1', () => {
    Vue.use(Vuex)
    const store = new Vuex.Store(storeConfig)
    expect(state.state.count).toBe(0)
    
    store.commit('increment')
    expect(store.state.count).toBe(1)
}
```
çœ‹èµ·æ¥ä¹Ÿæ˜¯æµ‹è¯•ä¸€ä¸ªç®€å•çš„`JavaScript`å‡½æ•°ä¸€æ ·ï¼Œæ²¡å•¥ä¸åŒçš„ã€‚ä½†æ˜¯åˆ«é«˜å…´çš„å¤ªæ—©ï¼Œå› ä¸ºè¿™ä¸ªä¾‹å­çŠ¯äº†ä¸€ä¸ªé”™ï¼Œå¯èƒ½æ˜¯å‰ç«¯éƒ½çŠ¯è¿‡çš„é”™ï¼Œå¯¹è±¡å¼•ç”¨ï¼

ä¸€ä¸ª`store`ä¸­çš„`state`å¯¹è±¡æ˜¯å¯¹`store`é…ç½®å¯¹è±¡ä¸­å®šä¹‰çš„`state`å¯¹è±¡çš„å¼•ç”¨ã€‚`store.state`çš„ä»»ä½•æ›´æ›´æ”¹éƒ½ä¼šæ”¹å˜`store`é…ç½®çš„`state`ã€‚åƒä¸Šé¢ä¾‹å­ä¸€ä¸ªï¼Œåœ¨æµ‹è¯•ä¸­æ”¹å˜äº†`state.count`çš„å€¼ï¼Œé‚£ä¹ˆåœ¨`store`é…ç½®çš„`state.count`ä¹Ÿå°†ä¼šæ”¹å˜ã€‚

è¿™æ˜¯å•å…ƒæµ‹è¯•çš„å¤§å¿Œï¼Œå› ä¸ºè¿›è¡Œå•å…ƒæµ‹è¯•ä»è€Œæ›´æ”¹äº†ç¨‹åºçš„è¿è¡Œã€‚è§£å†³æ–¹æ¡ˆä¹Ÿç®€å•ï¼Œå°±æ˜¯`clone`ä¸€ä¸ªæ–°çš„`store`é…ç½®å¯¹è±¡ã€‚

`Vue Test Utils`æœ‰ä¸€ä¸ª`createLocalVue`çš„`API`ï¼Œå®ƒå¯ä»¥åˆ›å»ºä¸€ä¸ª`localVue`æ„é€ å‡½æ•°ã€‚`localVue`æ„é€ å‡½æ•°æ˜¯ä¸€ä¸ªä»`Vue`åŸºç¡€æ„é€ å‡½æ•°æ‰©å±•è€Œæ¥çš„`VUE`æ„é€ å‡½æ•°ï¼Œå¯ä»¥åœ¨å…¶å®‰è£…æ’ä»¶è€Œä¸ä¼šå½±å“`Vue`åŸºç¡€æ„é€ å‡½æ•°ã€‚

### æµ‹è¯•VUEXå®ä¾‹
åˆ›å»ºä¸€ä¸ª`store module`ã€‚åŠŸèƒ½éå¸¸ç®€å•
* ä½¿ç”¨`actions`å‘å‡ºä¸€ä¸ª`fetchAlarmDetail`è¯·æ±‚ï¼Œå¾—åˆ°`alarm`çš„åå­—
* ç„¶ååœ¨`commit`ä¸€ä¸ª`changeAlarmNameçš„mutation`ï¼Œå°†ç»“æœå†™åœ¨`state.alarmName`ä¸Šã€‚
```js
import { fetchAlarmDetail } from '../api/alarmApi'
export const Alarm = {
  namespaced: true,
  state: {
    alarmName: ''
  },
  mutations: {
    changeAlarmName (state, data) {
      state.alarmName = data;
    },
  },
  actions: {
    fetchAlarmName ({commit}) {
      return fetchAlarmDetail().then(res => {
        commit('changeAlarmName', res)
      })
    }
  }
}
```
`fetchAlarmDetail`åŠŸèƒ½å¦‚ä¸‹ï¼š
```js
export const fetchAlarmDetail = () => {
  return new Promise((resolve, reject) => {
    try {
      setTimeout(() => {
        resolve('äººæœº')
      })
      
    } catch (error) {
      reject(error)
    }
  })
}
```

åˆ›å»ºä¸€ä¸ª`store.spec.js`æµ‹è¯•
```js
// æ¨¡æ‹Ÿapi
jest.mock('../../src/api/alarmApi.js')

// åˆ›å»ºlocalVueæ„é€ å‡½æ•°
const localVue = createLocalVue()
// åœ¨localVueæ„é€ å‡½æ•°ä¸Šå®‰è£…Vuex
localVue.use(Vuex)

describe('storeConfig', () => {
  test('dispatching fetchAlarmName to update alarmName', async () => {
    expect.assertions(2);

    // å¤åˆ¶Alarmçš„store module
    const cloneAlarm = cloneDeep(Alarm)
    const store = new Vuex.Store({
      modules: {
        cloneAlarm
      }
    })

    expect(store.state.cloneAlarm.alarmName).toBe('')

    // å®ç°fetchAlarmDetailæ¥å£ï¼Œå¹¶è¿”å›æ¨¡æ‹Ÿæ•°æ®
    alarmApi.fetchAlarmDetail.mockImplementationOnce(() => Promise.resolve('äººæœº'));
    // dispatch actions
    store.dispatch('cloneAlarm/fetchAlarmName')
    await flushPromises()
    expect(store.state.cloneAlarm.alarmName).toBe('äººæœº')
  })
})
```
è¿è¡Œ`yarn test:uni`ï¼Œé€šè¿‡ï¼

### æµ‹è¯•ç»„ä»¶ä¸­çš„VUEX
å½“ç„¶å•¦ï¼Œä¸åœ¨ç»„ä»¶ä½¿ç”¨`VUEX`ï¼Œé‚£ä¹ˆ`VUEX`å°±æ¯«æ— æ„ä¹‰ã€‚

å½“ç»„ä»¶ä¸­ä½¿ç”¨`VUEX`çš„`store`æ—¶ï¼Œè¯¥`store`å°±å˜æˆäº†ç»„ä»¶çš„ä¸€ä¸ªä¾èµ–ã€‚é€šè¿‡`Vuex`å’Œæ¨¡æ‹Ÿæ•°æ®åˆ›å»ºä¸€ä¸ª`store`å®ä¾‹å°±èƒ½æµ‹è¯•äº†

åœ¨ç»„ä»¶ä¸­ä½¿ç”¨`dispatch`ä¸€ä¸ª`action`
```js
// home.vue
async handleAlarmName () {
  this.$store.dispatch('Alarm/fetchAlarmName').then(res => {
    this.alarmName = res;
  })
},
```
åœ¨æµ‹è¯•ä¸­
```js
test('call handleAlarmName to update the this.alarmName', async () => {
  // å®šä¹‰Alarmï¼Œå°†åœ¨æ¯ä¸€ä¸ªæµ‹è¯•ä¹‹å‰è¢«é‡æ–°åˆ†é…
  const Alarm = {
    namespaced: true,
    actions: {
      // è®¾ç½®ä¸€ä¸ªmock fetchListData  actions
      fetchListData: jest.fn(() => Promise.resolve())
    }
  }
  const store = new Vuex.Store({
    modules: {
      Alarm
    }
  })
  expect.assertions(1);
  store.dispatch = jest.fn(() => Promise.resolve('äººæœº'))
  // æŒ‚è½½å®ä¾‹ï¼Œå¹¶æ³¨å…¥storeä¸localVue
  const wrapper = shallowMount(Home, { localVue, store })
  wrapper.vm.handleAlarmName();
  await flushPromises()
  expect(wrapper.vm.alarmName).toBe('äººæœº')
})
```
å®Œç¾

## æµ‹è¯•mixin
ä¸º`mixin`ç¼–å†™æµ‹è¯•å…¶å®å¾ˆç®€å•ã€‚åœ¨ä»£ç ä¸­æ³¨å†Œ`mixin`ï¼ŒæŒ‚è½½ç»„ä»¶ï¼Œç„¶åæ£€æµ‹`mixin`æ˜¯å¦äº§ç”Ÿäº†é¢„æœŸçš„è¡Œä¸ºå³å¯ã€‚

ç¼–å†™`mixin`
```js
export const titleMixin = {
  mounted() {
    document.title = 'hello mixin'
  },
}
```
åŠŸèƒ½å¾ˆç®€å•ï¼ŒæŒ‚è½½ä¹‹åå°†`document.title`æ”¹ä¸º`hello mixin`
```js
test('import titleMixin to change the title', () => {
  const component = {
    render() {},
    title: 'hello',
    // æ³¨å†Œmixin
    mixins: [titleMixin]
  }
  mount(component)
  expect(document.title).toBe('hello mixin')
})
```

## ç»“å°¾
å¥½äº†ï¼Œæœ¬æ¬¡å•å…ƒæµ‹è¯•ä¹‹æ—…åˆ°æ­¤ä¸ºæ­¢ã€‚å¦‚æœè§‰å¾—æœ‰å¸®åŠ©çš„è¯·ç‚¹ç‚¹èµï¼Œæ”¯æŒä¸€ä¸‹ã€‚

æ›´å¤šæ–‡ç« è¯·ç§»æ­¥[æ¥¼ä¸»github](https://github.com/zhangwinwin/FEBlog),å¦‚æœå–œæ¬¢è¯·ç‚¹ä¸€ä¸‹star,å¯¹ä½œè€…ä¹Ÿæ˜¯ä¸€ç§é¼“åŠ±ã€‚






