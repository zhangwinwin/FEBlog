(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{446:function(t,a,o){"use strict";o.r(a);var p=o(57),n=Object(p.a)({},(function(){var t=this,a=t.$createElement,o=t._self._c||a;return o("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[o("section",{staticStyle:{"font-size":"16px",padding:"0 10px","word-spacing":"0px","word-break":"break-word","word-wrap":"break-word","text-align":"left","line-height":"1.75",color:"#595959","font-family":"Optima-Regular, Optima, PingFangTC-Light, PingFangSC-light, PingFangTC-light","letter-spacing":"2px","background-image":"linear-gradient(90deg, rgba(50, 0, 0, 0.05) 3%, rgba(0, 0, 0, 0) 3%), linear-gradient(360deg, rgba(50, 0, 0, 0.05) 3%, rgba(0, 0, 0, 0) 3%)","background-size":"20px 20px","background-position":"center center"},attrs:{id:"nice","data-tool":"mdnice编辑器","data-website":"https://www.mdnice.com"}},[o("h2",{staticStyle:{"margin-top":"30px","margin-bottom":"15px",padding:"0px","font-weight":"bold",color:"black","font-size":"22px","text-align":"left",margin:"20px 10px 0px 0px"},attrs:{"data-tool":"mdnice编辑器"}},[o("span",{staticClass:"prefix",staticStyle:{display:"none"}}),o("span",{staticClass:"content",staticStyle:{"font-size":"18px","font-weight":"bold",display:"inline-block","padding-left":"10px","border-left":"5px solid #DEC6FB",color:"#595959"}},[t._v("前言")]),o("span",{staticClass:"suffix"})]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("对于前端开发者来说，多线程是一个比较陌生的话题。因为JavaScript是单线程语言。也就是说，所有任务只能在一个线程上完成，一次只能做一件事。前面的任务没做完，后面的任务只能等着。")]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("UI渲染与JavaScript是共同使用主线程。如果JavaScript运行过长，可能就会中断UI渲染，从而导致页面卡顿。")]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("为此，JavaScript推出了异步的处理方法。但终归到底还是单线程的。而且随着电脑计算能力的增强，尤其是多核CPU的出现，单线程带来很大的不便，无法充分发挥计算机的计算能力。")]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("Web Workers就应运而生了。通过使用Web Workers，Web应用程序可以在独立于主线程的后台线程中，运行一个脚本操作。这样做的好处是可以在独立线程中执行费时的处理任务，主线程从而不会因此被阻塞。")]),t._v(" "),o("h2",{staticStyle:{"margin-top":"30px","margin-bottom":"15px",padding:"0px","font-weight":"bold",color:"black","font-size":"22px","text-align":"left",margin:"20px 10px 0px 0px"},attrs:{"data-tool":"mdnice编辑器"}},[o("span",{staticClass:"prefix",staticStyle:{display:"none"}}),o("span",{staticClass:"content",staticStyle:{"font-size":"18px","font-weight":"bold",display:"inline-block","padding-left":"10px","border-left":"5px solid #DEC6FB",color:"#595959"}},[t._v("多线程")]),o("span",{staticClass:"suffix"})]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("我们从熟悉的领域入手来了解多线程是什么。")]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("通常从事开发的同学都对计算机配置有一定的了解，知道CPU配置中都标明几核几线程。比如说6核12线程、8核16线程等。")]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[o("img",{staticStyle:{"max-width":"100%","border-radius":"6px",display:"block",margin:"20px auto","object-fit":"contain"},attrs:{src:"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/7/4/17317bd78a3c61dd~tplv-t2oaga2asx-image.image",alt:""}}),t._v("（电脑比较渣，只有2核4线程）")]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("一般来说：一个CPU有几核就可以跑几个线程，比如说二核二线程--说明这个CPU同时最多能够运行两个线程，而二核四线程是使用了超线程技术，使得单个核像有两个核一样，速度要比二核二线程要快。")]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("了解了基本信息之后，来看看JavaScript的多线程--web workers。")]),t._v(" "),o("h3",{staticStyle:{"margin-top":"30px","margin-bottom":"15px",padding:"0px",color:"black","font-size":"16px","font-weight":"bold","text-align":"center"},attrs:{"data-tool":"mdnice编辑器"}},[o("span",{staticClass:"prefix",staticStyle:{display:"none"}}),o("span",{staticClass:"content",staticStyle:{"border-bottom":"2px solid #DEC6FB",color:"#595959"}},[t._v("web workers")]),o("span",{staticClass:"suffix",staticStyle:{display:"none"}})]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("HTML5引入了Web Workers，让JavaScript支持多线程。接下来用Web Workers做一个斐波那契函数来举例：")]),t._v(" "),o("pre",{staticClass:"custom",staticStyle:{"margin-top":"10px","margin-bottom":"10px","border-radius":"5px","box-shadow":"rgba(0, 0, 0, 0.55) 0px 2px 10px"},attrs:{"data-tool":"mdnice编辑器"}},[o("span",{staticStyle:{display:"block",background:"url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png)",height:"30px",width:"100%","background-size":"40px","background-repeat":"no-repeat","background-color":"#1E1E1E","margin-bottom":"-7px","border-radius":"5px","background-position":"10px 10px"}}),o("code",{staticClass:"hljs",staticStyle:{"overflow-x":"auto",padding:"16px",color:"#DCDCDC",display:"block","font-family":"Operator Mono, Consolas, Monaco, Menlo, monospace","font-size":"12px","-webkit-overflow-scrolling":"touch","padding-top":"15px",background:"#1E1E1E","border-radius":"5px"}},[t._v("// worker.js\n"),o("span"),o("span",{staticClass:"hljs-keyword",staticStyle:{color:"#569CD6","line-height":"26px"}},[t._v("function")]),t._v(" fibonacci(n) {\n"),o("span"),t._v("    "),o("span",{staticClass:"hljs-keyword",staticStyle:{color:"#569CD6","line-height":"26px"}},[t._v("function")]),t._v(" fib(n, v1, v2) {\n"),o("span"),t._v("        "),o("span",{staticClass:"hljs-keyword",staticStyle:{color:"#569CD6","line-height":"26px"}},[t._v("if")]),t._v(" (n == 1)\n"),o("span"),t._v("            "),o("span",{staticClass:"hljs-built_in",staticStyle:{color:"#4EC9B0","line-height":"26px"}},[t._v("return")]),t._v(" v1;\n"),o("span"),t._v("        "),o("span",{staticClass:"hljs-keyword",staticStyle:{color:"#569CD6","line-height":"26px"}},[t._v("if")]),t._v(" (n == 2)\n"),o("span"),t._v("            "),o("span",{staticClass:"hljs-built_in",staticStyle:{color:"#4EC9B0","line-height":"26px"}},[t._v("return")]),t._v(" v2;\n"),o("span"),t._v("        "),o("span",{staticClass:"hljs-keyword",staticStyle:{color:"#569CD6","line-height":"26px"}},[t._v("else")]),t._v("\n"),o("span"),t._v("            "),o("span",{staticClass:"hljs-built_in",staticStyle:{color:"#4EC9B0","line-height":"26px"}},[t._v("return")]),t._v(" fib(n - 1, v2, v1 + v2);\n"),o("span"),t._v("    }\n"),o("span"),t._v("    "),o("span",{staticClass:"hljs-built_in",staticStyle:{color:"#4EC9B0","line-height":"26px"}},[t._v("return")]),t._v(" fib(n, 1, 1)\n"),o("span"),t._v("}\n"),o("span"),t._v("\n"),o("span"),t._v("// 通过onmessage回调函数接收主线程的数据\n"),o("span"),t._v("onmessage = "),o("span",{staticClass:"hljs-keyword",staticStyle:{color:"#569CD6","line-height":"26px"}},[t._v("function")]),t._v(" (e) {\n"),o("span"),t._v("    // 通过e.data接收从主线程中传过来的数据。\n"),o("span"),t._v("    var num = e.data;\n"),o("span"),t._v("    var result = fibonacci(num);\n"),o("span"),t._v("    // 通过postMessage向主线程传输结果。\n"),o("span"),t._v("    postMessage(result);\n"),o("span"),t._v("}\n"),o("span")])]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("把这个函数写到worker.js中。接着在index.js文件中使用new关键字，调用Worker()构造函数，新建一个Worker线程。")]),t._v(" "),o("pre",{staticClass:"custom",staticStyle:{"margin-top":"10px","margin-bottom":"10px","border-radius":"5px","box-shadow":"rgba(0, 0, 0, 0.55) 0px 2px 10px"},attrs:{"data-tool":"mdnice编辑器"}},[o("span",{staticStyle:{display:"block",background:"url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png)",height:"30px",width:"100%","background-size":"40px","background-repeat":"no-repeat","background-color":"#1E1E1E","margin-bottom":"-7px","border-radius":"5px","background-position":"10px 10px"}}),o("code",{staticClass:"hljs",staticStyle:{"overflow-x":"auto",padding:"16px",color:"#DCDCDC",display:"block","font-family":"Operator Mono, Consolas, Monaco, Menlo, monospace","font-size":"12px","-webkit-overflow-scrolling":"touch","padding-top":"15px",background:"#1E1E1E","border-radius":"5px"}},[t._v("// index.js\n"),o("span"),t._v("var worker = new Worker("),o("span",{staticClass:"hljs-string",staticStyle:{color:"#D69D85","line-height":"26px"}},[t._v("'worker.js文件的url'")]),t._v(");\n"),o("span"),t._v("\n"),o("span"),t._v("worker.onmessage = "),o("span",{staticClass:"hljs-keyword",staticStyle:{color:"#569CD6","line-height":"26px"}},[t._v("function")]),t._v(" (e) {\n"),o("span"),t._v("    console.log("),o("span",{staticClass:"hljs-string",staticStyle:{color:"#D69D85","line-height":"26px"}},[t._v('"result: "')]),t._v(" + e.data);\n"),o("span"),t._v("}\n"),o("span"),t._v("worker.postMessage(100);\n"),o("span"),t._v("\n"),o("span"),t._v("worker.terminate();\n"),o("span")])]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("Worker()构造函数的参数是刚刚定义的worker脚本文件。但是Worker构造函数不能读取本地文件，所以这个脚本必须来自网络。然后，调用worker.postMessage()方法，向Worker发消息。最后，主通过worker.onmessage指定监听函数，接收Worker发回来的消息。Worker完成任务以后，就可以把它关掉。")]),t._v(" "),o("h3",{staticStyle:{"margin-top":"30px","margin-bottom":"15px",padding:"0px",color:"black","font-size":"16px","font-weight":"bold","text-align":"center"},attrs:{"data-tool":"mdnice编辑器"}},[o("span",{staticClass:"prefix",staticStyle:{display:"none"}}),o("span",{staticClass:"content",staticStyle:{"border-bottom":"2px solid #DEC6FB",color:"#595959"}},[t._v("数据通信")]),o("span",{staticClass:"suffix",staticStyle:{display:"none"}})]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("主线程与Worker之间的通信内容，可以是基本类型的，也可以是引用类型的，而且是通过值传递的。Worker对通信内容的修改，不会影响到主线程。事实上，浏览器内部的运行机制是，先将通信内容通过类似JSON.stringify()的api将内容转为字符串，再传给Worker，后者将其还原。")]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("正如所想的那样，这种方式会造成性能问题。当主线程向Worker发送几百上千兆大小的文件，默认情况下浏览器会将其拷贝一份。为了解决这个问题，JavaScript允许主线程通过TransferableObjects方法把数据直接转移给Worker线程，但是一旦传输了，主线程就再也无法使用这些数据了。这是为了防止出现多个线程同时处理数据的风险。")]),t._v(" "),o("pre",{staticClass:"custom",staticStyle:{"margin-top":"10px","margin-bottom":"10px","border-radius":"5px","box-shadow":"rgba(0, 0, 0, 0.55) 0px 2px 10px"},attrs:{"data-tool":"mdnice编辑器"}},[o("span",{staticStyle:{display:"block",background:"url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png)",height:"30px",width:"100%","background-size":"40px","background-repeat":"no-repeat","background-color":"#1E1E1E","margin-bottom":"-7px","border-radius":"5px","background-position":"10px 10px"}}),o("code",{staticClass:"hljs",staticStyle:{"overflow-x":"auto",padding:"16px",color:"#DCDCDC",display:"block","font-family":"Operator Mono, Consolas, Monaco, Menlo, monospace","font-size":"12px","-webkit-overflow-scrolling":"touch","padding-top":"15px",background:"#1E1E1E","border-radius":"5px"}},[t._v("// Transferable Objects 格式\n"),o("span"),t._v("worker.postMessage(arrayBuffer, [arrayBuffer]);\n"),o("span"),t._v("\n"),o("span"),t._v("// 例子\n"),o("span"),t._v("var ab = new ArrayBuffer(1);\n"),o("span"),t._v("worker.postMessage(ab, [ab]);\n"),o("span")])]),t._v(" "),o("h3",{staticStyle:{"margin-top":"30px","margin-bottom":"15px",padding:"0px",color:"black","font-size":"16px","font-weight":"bold","text-align":"center"},attrs:{"data-tool":"mdnice编辑器"}},[o("span",{staticClass:"prefix",staticStyle:{display:"none"}}),o("span",{staticClass:"content",staticStyle:{"border-bottom":"2px solid #DEC6FB",color:"#595959"}},[t._v("内联Web Worker")]),o("span",{staticClass:"suffix",staticStyle:{display:"none"}})]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("一般来说，Web Worker的载入是一个单独的JavaScript脚本文件，但也是可以与主线程用一个文件中载入：")]),t._v(" "),o("pre",{staticClass:"custom",staticStyle:{"margin-top":"10px","margin-bottom":"10px","border-radius":"5px","box-shadow":"rgba(0, 0, 0, 0.55) 0px 2px 10px"},attrs:{"data-tool":"mdnice编辑器"}},[o("span",{staticStyle:{display:"block",background:"url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png)",height:"30px",width:"100%","background-size":"40px","background-repeat":"no-repeat","background-color":"#1E1E1E","margin-bottom":"-7px","border-radius":"5px","background-position":"10px 10px"}}),o("code",{staticClass:"hljs",staticStyle:{"overflow-x":"auto",padding:"16px",color:"#DCDCDC",display:"block","font-family":"Operator Mono, Consolas, Monaco, Menlo, monospace","font-size":"12px","-webkit-overflow-scrolling":"touch","padding-top":"15px",background:"#1E1E1E","border-radius":"5px"}},[t._v("<!DOCTYPE html>\n"),o("span"),t._v("    <body>\n"),o("span"),t._v("        <script id="),o("span",{staticClass:"hljs-string",staticStyle:{color:"#D69D85","line-height":"26px"}},[t._v("'worker'")]),t._v(" "),o("span",{staticClass:"hljs-built_in",staticStyle:{color:"#4EC9B0","line-height":"26px"}},[t._v("type")]),t._v("="),o("span",{staticClass:"hljs-string",staticStyle:{color:"#D69D85","line-height":"26px"}},[t._v("'app/worker'")]),t._v(">\n"),o("span"),t._v("            "),o("span",{staticClass:"hljs-keyword",staticStyle:{color:"#569CD6","line-height":"26px"}},[t._v("function")]),t._v(" fibonacci(n) {\n"),o("span"),t._v("               ...\n"),o("span"),t._v("            }\n"),o("span"),t._v("            \n"),o("span"),t._v("            // 通过onmessage回调函数接收主线程的数据\n"),o("span"),t._v("            onmessage = "),o("span",{staticClass:"hljs-keyword",staticStyle:{color:"#569CD6","line-height":"26px"}},[t._v("function")]),t._v(" (e) {\n"),o("span"),t._v("                // 通过e.data接收从主线程中传过来的数据。\n"),o("span"),t._v("                var num = e.data;\n"),o("span"),t._v("                var result = fibonacci(num);\n"),o("span"),t._v("                // 通过postMessage向主线程传输结果。\n"),o("span"),t._v("                postMessage(result);\n"),o("span"),t._v("            }\n"),o("span"),t._v("        <\/script>\n"),o("span"),t._v("    </body>\n"),o("span"),t._v("</html>\n"),o("span")])]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("必须指定"),o("code",{staticStyle:{"font-size":"14px","word-wrap":"break-word",padding:"2px 4px","border-radius":"4px",margin:"0 2px","background-color":"rgba(27,31,35,.05)","font-family":"Operator Mono, Consolas, Monaco, Menlo, monospace","word-break":"break-all",color:"#595959"}},[t._v("<script>")]),t._v("标签的type属性是一个浏览器不认识的值，比如app/worker")]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("然后，读取这段嵌入页面的脚本，用Worker来处理")]),t._v(" "),o("pre",{staticClass:"custom",staticStyle:{"margin-top":"10px","margin-bottom":"10px","border-radius":"5px","box-shadow":"rgba(0, 0, 0, 0.55) 0px 2px 10px"},attrs:{"data-tool":"mdnice编辑器"}},[o("span",{staticStyle:{display:"block",background:"url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png)",height:"30px",width:"100%","background-size":"40px","background-repeat":"no-repeat","background-color":"#1E1E1E","margin-bottom":"-7px","border-radius":"5px","background-position":"10px 10px"}}),o("code",{staticClass:"hljs",staticStyle:{"overflow-x":"auto",padding:"16px",color:"#DCDCDC",display:"block","font-family":"Operator Mono, Consolas, Monaco, Menlo, monospace","font-size":"12px","-webkit-overflow-scrolling":"touch","padding-top":"15px",background:"#1E1E1E","border-radius":"5px"}},[t._v("var blob = new Blob([document.querySelector("),o("span",{staticClass:"hljs-string",staticStyle:{color:"#D69D85","line-height":"26px"}},[t._v("'#worker'")]),t._v(").textContent]);\n"),o("span"),t._v("var url = window.URL.createObjectURL(blob);\n"),o("span"),t._v("var worker = new Worker(url);\n"),o("span"),t._v("\n"),o("span"),t._v("worker.onmessage = "),o("span",{staticClass:"hljs-keyword",staticStyle:{color:"#569CD6","line-height":"26px"}},[t._v("function")]),t._v(" (e) {\n"),o("span"),t._v("    console.log("),o("span",{staticClass:"hljs-string",staticStyle:{color:"#D69D85","line-height":"26px"}},[t._v('"result: "')]),t._v(" + e.data);\n"),o("span"),t._v("}\n"),o("span"),t._v("worker.postMessage(100);\n"),o("span")])]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("先将嵌入网页的脚本代码，转为一个二进制对象，然后为这个二进制对象生成URL，再让Worker加URL。done")]),t._v(" "),o("h3",{staticStyle:{"margin-top":"30px","margin-bottom":"15px",padding:"0px",color:"black","font-size":"16px","font-weight":"bold","text-align":"center"},attrs:{"data-tool":"mdnice编辑器"}},[o("span",{staticClass:"prefix",staticStyle:{display:"none"}}),o("span",{staticClass:"content",staticStyle:{"border-bottom":"2px solid #DEC6FB",color:"#595959"}},[t._v("线程同步")]),o("span",{staticClass:"suffix",staticStyle:{display:"none"}})]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("最后来说说JavaScript版本的线程同步。")]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("由于Web Workers是不可以操作DOM的，因为同一个DOM节点只能有一个线程操作，不允许同一个变量或者内存被同时写入。")]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("如果web Workers可以操作DOM呢？那会怎么样，当然是要用到线程同步的方式限制线程写入。")]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("同步的意思是协同、互相配合的意思，按照预定的先后次序进行运行。比如说线程A和线程B同步，A执行到一定程度时要依赖B的某个运行结果，那么就必须先停下来，让B运行，B运行完后，把结果给到A，A再继续操作。")]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("线程同步主要是靠锁来实现的，可以分为以下3种：")]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[o("strong",{staticStyle:{color:"#595959","font-weight":"bold"}},[o("span",[t._v("「")]),t._v("互斥锁"),o("span",[t._v("」")])])]),t._v(" "),o("pre",{staticClass:"custom",staticStyle:{"margin-top":"10px","margin-bottom":"10px","border-radius":"5px","box-shadow":"rgba(0, 0, 0, 0.55) 0px 2px 10px"},attrs:{"data-tool":"mdnice编辑器"}},[o("span",{staticStyle:{display:"block",background:"url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png)",height:"30px",width:"100%","background-size":"40px","background-repeat":"no-repeat","background-color":"#1E1E1E","margin-bottom":"-7px","border-radius":"5px","background-position":"10px 10px"}}),o("code",{staticClass:"hljs",staticStyle:{"overflow-x":"auto",padding:"16px",color:"#DCDCDC",display:"block","font-family":"Operator Mono, Consolas, Monaco, Menlo, monospace","font-size":"12px","-webkit-overflow-scrolling":"touch","padding-top":"15px",background:"#1E1E1E","border-radius":"5px"}},[t._v("var mutext = new Mutext();\n"),o("span"),o("span",{staticClass:"hljs-keyword",staticStyle:{color:"#569CD6","line-height":"26px"}},[t._v("function")]),t._v(" changeDOM (style) {\n"),o("span"),t._v("    mutext.lock();\n"),o("span"),t._v("    document.getElementById("),o("span",{staticClass:"hljs-string",staticStyle:{color:"#D69D85","line-height":"26px"}},[t._v("'app'")]),t._v(").style = style;\n"),o("span"),t._v("    mutext.unlock();\n"),o("span"),t._v("}\n"),o("span"),t._v("\n"),o("span"),t._v("// worker1\n"),o("span"),t._v("changeStyle({width: 100px});\n"),o("span"),t._v("\n"),o("span"),t._v("// worker2\n"),o("span"),t._v("changeStyle({width: 150px});\n"),o("span")])]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("在改变某个DOM元素的样式时，先把这部分代码的执行给锁住了，只有执行完了才释放这把锁，其他线程运行到这时也要去申请那把锁，但是由于这把锁没有被释放，所以它就阻塞在那里，只有等到锁被释放了，它才能拿到这把锁再继续加锁。")]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("互斥锁使用太多会导致性能下降，因为线程阻塞在那里而且还要不断的检测锁能不能用，所以要占用CPU。")]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[o("strong",{staticStyle:{color:"#595959","font-weight":"bold"}},[o("span",[t._v("「")]),t._v("读写锁"),o("span",[t._v("」")])])]),t._v(" "),o("pre",{staticClass:"custom",staticStyle:{"margin-top":"10px","margin-bottom":"10px","border-radius":"5px","box-shadow":"rgba(0, 0, 0, 0.55) 0px 2px 10px"},attrs:{"data-tool":"mdnice编辑器"}},[o("span",{staticStyle:{display:"block",background:"url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png)",height:"30px",width:"100%","background-size":"40px","background-repeat":"no-repeat","background-color":"#1E1E1E","margin-bottom":"-7px","border-radius":"5px","background-position":"10px 10px"}}),o("code",{staticClass:"hljs",staticStyle:{"overflow-x":"auto",padding:"16px",color:"#DCDCDC",display:"block","font-family":"Operator Mono, Consolas, Monaco, Menlo, monospace","font-size":"12px","-webkit-overflow-scrolling":"touch","padding-top":"15px",background:"#1E1E1E","border-radius":"5px"}},[t._v("var rwLock = new ReadWriteLock();\n"),o("span"),o("span",{staticClass:"hljs-keyword",staticStyle:{color:"#569CD6","line-height":"26px"}},[t._v("function")]),t._v(" changeStyle (style) {\n"),o("span"),t._v("    rwLock.writeLock();\n"),o("span"),t._v("    document.getElementById("),o("span",{staticClass:"hljs-string",staticStyle:{color:"#D69D85","line-height":"26px"}},[t._v("'app'")]),t._v(").style = style;\n"),o("span"),t._v("    rwLock.unlock();\n"),o("span"),t._v("}\n"),o("span"),t._v("\n"),o("span"),o("span",{staticClass:"hljs-keyword",staticStyle:{color:"#569CD6","line-height":"26px"}},[t._v("function")]),t._v(" "),o("span",{staticClass:"hljs-function",staticStyle:{color:"#DCDCDC","line-height":"26px"}},[o("span",{staticClass:"hljs-title",staticStyle:{color:"#DCDCDC","line-height":"26px"}},[t._v("getStyle")])]),t._v(" () {\n"),o("span"),t._v("    rwLock.readLock();\n"),o("span"),t._v("    var style = document.getElementById("),o("span",{staticClass:"hljs-string",staticStyle:{color:"#D69D85","line-height":"26px"}},[t._v("'app'")]),t._v(").style\n"),o("span"),t._v("    rwLock.unlock();\n"),o("span"),t._v("    "),o("span",{staticClass:"hljs-built_in",staticStyle:{color:"#4EC9B0","line-height":"26px"}},[t._v("return")]),t._v(" style;\n"),o("span"),t._v("}\n"),o("span")])]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("在第二个函数getStyle()获取样式时可以给它加一个读锁，这样其他线程如果想读是可以同时读的，但是不允许有一个线程写入。如果有线程调用了第一个函数，那么调用第二个函数的线程都会被阻塞，因为在写的过程中，不运行被读取。")]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[o("strong",{staticStyle:{color:"#595959","font-weight":"bold"}},[o("span",[t._v("「")]),t._v("条件变量"),o("span",[t._v("」")])]),o("br"),t._v("\n条件变量是为解决生产者和消费者的问题，由于互斥锁和读写锁会导致线程一直阻塞而且占用CPU，而使用信号通知的方式可以先让阻塞的线程进入睡眠状态，等生产者生产出东西后通知消费者，再唤醒它进行消费。")]),t._v(" "),o("p",{staticStyle:{"padding-top":"8px","padding-bottom":"8px","line-height":"26px",color:"#595959",margin:"10px 0px","letter-spacing":"2px","font-size":"14px","word-spacing":"2px"},attrs:{"data-tool":"mdnice编辑器"}},[t._v("然而现实上JavaScript是没有线程同步的概念。因为webWorker是无法操作DOM，也没有window对象，每个线程的数据都是独立的。前面说过是通过拷贝复制的方式传递的。所以不存在共享同一块内存区域。")]),t._v(" "),o("h2",{staticStyle:{"margin-top":"30px","margin-bottom":"15px",padding:"0px","font-weight":"bold",color:"black","font-size":"22px","text-align":"left",margin:"20px 10px 0px 0px"},attrs:{"data-tool":"mdnice编辑器"}},[o("span",{staticClass:"prefix",staticStyle:{display:"none"}}),o("span",{staticClass:"content",staticStyle:{"font-size":"18px","font-weight":"bold",display:"inline-block","padding-left":"10px","border-left":"5px solid #DEC6FB",color:"#595959"}},[t._v("结尾")]),o("span",{staticClass:"suffix"})])])])}),[],!1,null,null,null);a.default=n.exports}}]);