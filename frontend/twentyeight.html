<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VUEå•å…ƒæµ‹è¯•--è¿›é˜¶ä¹‹è·¯ | zhangwinwin&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">
    <link rel="stylesheet" href="https://gitcdn.xyz/cdn/goessner/markdown-it-texmath/master/texmath.css">
    <script src="https://github.com/markdown-it/markdown-it/blob/master/bin/markdown-it.js"></script>
    <script src="https://gitcdn.xyz/cdn/goessner/markdown-it-texmath/master/texmath.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
    <meta name="description" content="some technical articles on programming, especially webgl">
    
    <link rel="preload" href="/FEBlog/assets/css/0.styles.d6193a66.css" as="style"><link rel="preload" href="/FEBlog/assets/js/app.b158500d.js" as="script"><link rel="preload" href="/FEBlog/assets/js/2.7d7fb6cb.js" as="script"><link rel="preload" href="/FEBlog/assets/js/38.ebd67282.js" as="script"><link rel="prefetch" href="/FEBlog/assets/js/10.f2a2cc76.js"><link rel="prefetch" href="/FEBlog/assets/js/11.9d2c86e2.js"><link rel="prefetch" href="/FEBlog/assets/js/12.b8ebcb32.js"><link rel="prefetch" href="/FEBlog/assets/js/13.c4ca47c5.js"><link rel="prefetch" href="/FEBlog/assets/js/14.a3911fae.js"><link rel="prefetch" href="/FEBlog/assets/js/15.f3798b20.js"><link rel="prefetch" href="/FEBlog/assets/js/16.3988fd0d.js"><link rel="prefetch" href="/FEBlog/assets/js/17.a3bff097.js"><link rel="prefetch" href="/FEBlog/assets/js/18.0402de45.js"><link rel="prefetch" href="/FEBlog/assets/js/19.64dfd7bd.js"><link rel="prefetch" href="/FEBlog/assets/js/20.8ae18d54.js"><link rel="prefetch" href="/FEBlog/assets/js/21.686fbff4.js"><link rel="prefetch" href="/FEBlog/assets/js/22.f37786bd.js"><link rel="prefetch" href="/FEBlog/assets/js/23.d01475c6.js"><link rel="prefetch" href="/FEBlog/assets/js/24.b50cb274.js"><link rel="prefetch" href="/FEBlog/assets/js/25.dec00c3c.js"><link rel="prefetch" href="/FEBlog/assets/js/26.be064a51.js"><link rel="prefetch" href="/FEBlog/assets/js/27.204b551b.js"><link rel="prefetch" href="/FEBlog/assets/js/28.843b63a9.js"><link rel="prefetch" href="/FEBlog/assets/js/29.58e09b07.js"><link rel="prefetch" href="/FEBlog/assets/js/3.65fb9823.js"><link rel="prefetch" href="/FEBlog/assets/js/30.68fadd92.js"><link rel="prefetch" href="/FEBlog/assets/js/31.da110779.js"><link rel="prefetch" href="/FEBlog/assets/js/32.fd8ecdbf.js"><link rel="prefetch" href="/FEBlog/assets/js/33.ab43cbf0.js"><link rel="prefetch" href="/FEBlog/assets/js/34.9eb09d94.js"><link rel="prefetch" href="/FEBlog/assets/js/35.d24309ed.js"><link rel="prefetch" href="/FEBlog/assets/js/36.2b760384.js"><link rel="prefetch" href="/FEBlog/assets/js/37.cf57d516.js"><link rel="prefetch" href="/FEBlog/assets/js/39.390dc348.js"><link rel="prefetch" href="/FEBlog/assets/js/4.6e58adc1.js"><link rel="prefetch" href="/FEBlog/assets/js/40.9dba16d5.js"><link rel="prefetch" href="/FEBlog/assets/js/41.a3240bd5.js"><link rel="prefetch" href="/FEBlog/assets/js/42.eb5be3bf.js"><link rel="prefetch" href="/FEBlog/assets/js/43.730ebcf4.js"><link rel="prefetch" href="/FEBlog/assets/js/44.ccc62d57.js"><link rel="prefetch" href="/FEBlog/assets/js/45.ad1d828c.js"><link rel="prefetch" href="/FEBlog/assets/js/46.5b36dcbd.js"><link rel="prefetch" href="/FEBlog/assets/js/47.4a801f44.js"><link rel="prefetch" href="/FEBlog/assets/js/48.7e166c43.js"><link rel="prefetch" href="/FEBlog/assets/js/49.23c05926.js"><link rel="prefetch" href="/FEBlog/assets/js/5.720089dd.js"><link rel="prefetch" href="/FEBlog/assets/js/50.4e03a0f5.js"><link rel="prefetch" href="/FEBlog/assets/js/51.e42c88ba.js"><link rel="prefetch" href="/FEBlog/assets/js/52.f07316b9.js"><link rel="prefetch" href="/FEBlog/assets/js/53.eb8ab9b1.js"><link rel="prefetch" href="/FEBlog/assets/js/54.4cd69611.js"><link rel="prefetch" href="/FEBlog/assets/js/55.d67f2251.js"><link rel="prefetch" href="/FEBlog/assets/js/56.0e8e4426.js"><link rel="prefetch" href="/FEBlog/assets/js/57.e6a8e7d6.js"><link rel="prefetch" href="/FEBlog/assets/js/58.4cf7f096.js"><link rel="prefetch" href="/FEBlog/assets/js/59.fd6482f8.js"><link rel="prefetch" href="/FEBlog/assets/js/6.837ac311.js"><link rel="prefetch" href="/FEBlog/assets/js/60.3ce8a368.js"><link rel="prefetch" href="/FEBlog/assets/js/61.3162b2a8.js"><link rel="prefetch" href="/FEBlog/assets/js/62.ced16e8f.js"><link rel="prefetch" href="/FEBlog/assets/js/63.645bd795.js"><link rel="prefetch" href="/FEBlog/assets/js/64.4f65269b.js"><link rel="prefetch" href="/FEBlog/assets/js/65.14527b40.js"><link rel="prefetch" href="/FEBlog/assets/js/66.e572cb43.js"><link rel="prefetch" href="/FEBlog/assets/js/7.f30bf9bf.js"><link rel="prefetch" href="/FEBlog/assets/js/8.2380c336.js"><link rel="prefetch" href="/FEBlog/assets/js/9.f775cc22.js">
    <link rel="stylesheet" href="/FEBlog/assets/css/0.styles.d6193a66.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/FEBlog/" class="home-link router-link-active"><!----> <span class="site-name">zhangwinwin's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/FEBlog/" class="nav-link">
  Intro
</a></div><div class="nav-item"><a href="/FEBlog/webgl/" class="nav-link">
  Webgl
</a></div><div class="nav-item"><a href="/FEBlog/frontend/" class="nav-link router-link-active">
  Frontend
</a></div><div class="nav-item"><a href="/FEBlog/network/" class="nav-link">
  Network
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="åšå®¢åœ°å€" class="dropdown-title"><span class="title">åšå®¢åœ°å€</span> <span class="arrow down"></span></button> <button type="button" aria-label="åšå®¢åœ°å€" class="mobile-dropdown-title"><span class="title">åšå®¢åœ°å€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zhangwinwin/FEBlog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1486195453331757" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ˜é‡‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/FEBlog/" class="nav-link">
  Intro
</a></div><div class="nav-item"><a href="/FEBlog/webgl/" class="nav-link">
  Webgl
</a></div><div class="nav-item"><a href="/FEBlog/frontend/" class="nav-link router-link-active">
  Frontend
</a></div><div class="nav-item"><a href="/FEBlog/network/" class="nav-link">
  Network
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="åšå®¢åœ°å€" class="dropdown-title"><span class="title">åšå®¢åœ°å€</span> <span class="arrow down"></span></button> <button type="button" aria-label="åšå®¢åœ°å€" class="mobile-dropdown-title"><span class="title">åšå®¢åœ°å€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zhangwinwin/FEBlog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1486195453331757" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ˜é‡‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="å‰è¨€">å‰è¨€</h2> <p>å…¨æ–¹ä½çš„ä»‹ç»å¦‚ä½•ä½¿ç”¨<code>JEST</code>æµ‹è¯•ä¸€ä¸ªVUEç»„ä»¶ã€‚<br>
ï¼ˆå¦‚æœä¸çŸ¥é“æ€ä¹ˆå¼€å§‹<code>VUE</code>å•å…ƒæµ‹è¯•çš„åŒå­¦ä»¬ï¼Œè¯·æŸ¥çœ‹ä¹‹å‰çš„æ–‡ç« <a href="https://juejin.cn/post/6906295144505409549" target="_blank" rel="noopener noreferrer">VUEå•å…ƒæµ‹è¯•--å¼€å¯æµ‹è¯•ä¹‹æ—…<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼‰</p> <p>ç€é‡ä»‹ç»åœ¨ä½¿ç”¨<code>Vue.extend</code>åˆ›å»ºæ„é€ å‡½æ•°çš„å½¢å¼æ³¨å†Œçš„ç»„ä»¶ï¼ŒåŒ…æ‹¬ï¼š</p> <ul><li>æµ‹è¯•å®šæ—¶å™¨å‡½æ•°</li> <li>æµ‹è¯•<code>HTTP</code>è¯·æ±‚</li> <li>æµ‹è¯•äº‹ä»¶
ç­‰è¿™å‡ ä¸ªéƒ¨åˆ†çš„ä»‹ç»</li></ul> <p>ä»£ç åœ¨<a href="https://github.com/zhangwinwin/FEBlog/tree/master/unitest" target="_blank" rel="noopener noreferrer">github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æ¬¢è¿ç‚¹èµğŸ‘</p> <h2 id="æµ‹è¯•ç»„ä»¶">æµ‹è¯•ç»„ä»¶</h2> <p>æµ‹è¯•ç»„ä»¶ï¼Œå…¶å®å°±æ˜¯æµ‹è¯•ç»„ä»¶çš„æ–¹æ³•ä»¥åŠæ–¹æ³•æ‰€ä¾èµ–çš„æ¨¡å—ã€‚<br>
æµ‹è¯•ç»„ä»¶æ–¹æ³•å¾ˆç®€å•ï¼šè°ƒç”¨ç»„ä»¶æ–¹æ³•å¹¶æ–­è¨€æ–¹æ³•èƒ½ç”¨æ­£ç¡®åœ°å½±å“äº†ç»„ä»¶çš„è¾“å‡ºå³å¯ã€‚</p> <p>ä»ä¸€ä¸ªä¾‹å­å‡ºå‘ï¼Œæµ‹è¯•ä¸€ä¸ªè¿›åº¦æ¡ç»„ä»¶</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;template&gt;
  &lt;div class=&quot;Progress-Bar&quot; :class=&quot;{hidden: hidden}&quot;&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  name: 'ProgressBar',
  data () {
    return {
      hidden: true
    }
  },
  methods: {
    start () {
      this.hidden = false;
    },
    finally () {
      this.hidden = true;
    }
  },
}
&lt;/script&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>ä»£ç ä¸€ç›®äº†ç„¶ï¼Œå½“è°ƒç”¨<code>start</code>æ–¹æ³•æ—¶ï¼Œåº”è¯¥å±•ç¤ºè¿›åº¦æ¡ï¼›å½“è°ƒç”¨<code>finally</code>æ–¹æ³•æ—¶ï¼Œåº”è¯¥å±è”½è¿›åº¦æ¡ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import { shallowMount } from '@vue/test-utils';
import ProgressBar from '@/views/ProgressBar.vue';

describe('test progress', () =&gt; {
  it('when start is clicked, show the progressBar', () =&gt; {
    const wrapper = shallowMount(ProgressBar);
    expect(wrapper.classes()).toContain('hidden');
    wrapper.vm.start();
    wrapper.vm.finally();
    expect(wrapper.classes()).toContain('hidden');
  })
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>è¿è¡Œ<code>yarn test:unit</code>æ—¶ï¼Œæµ‹è¯•é€šè¿‡ã€‚</p> <p>è¿™æ˜¯ç®€å•çš„ç»„ä»¶æµ‹è¯•ã€‚</p> <h3 id="vueå®ä¾‹æ·»åŠ å±æ€§">Vueå®ä¾‹æ·»åŠ å±æ€§</h3> <p>äº‹å®ä¸Šè¿˜æœ‰ä¸€ç§éå¸¸å¸¸è§çš„ç»„ä»¶æ¨¡å¼ï¼Œå°±æ˜¯å¾€<code>Vue</code>å®ä¾‹æ·»åŠ å±æ€§ã€‚åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ä¹Ÿä»‹ç»è¿‡ï¼Œç”¨è¿™<a href="https://juejin.cn/post/6893303835251441677" target="_blank" rel="noopener noreferrer">VUEçš„â€œåŠ¨æ€â€æ¡ˆä¾‹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ä»‹ç»çš„ç»„ä»¶æ¥åšä¾‹å­ï¼Œç»„ä»¶çš„å…·ä½“å¼€å‘å°±ä¸å¤šä½œä»‹ç»äº†ï¼Œä»£ç åœ¨ä»£ç åœ¨<a href="https://github.com/zhangwinwin/FEBlog/tree/master/unitest" target="_blank" rel="noopener noreferrer">github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ä¸­ã€‚<br>
ï¼ˆè¿›å…¥åˆ°<code>unitest</code>æ–‡ä»¶å¤¹ä¸­ï¼Œè¿è¡Œ<code>yarn serve</code>ã€‚ï¼‰</p> <p>åŠŸèƒ½ï¼šç‚¹å‡»æŒ‰é’®è§¦å‘<code>handleCheck</code>äº‹ä»¶ï¼Œå¼¹å‡º<code>alarm</code>å¼¹çª—ï¼Œå¼¹çª—<code>id</code>å°±æ˜¯åœ¨<code>primaryId</code>åŸºç¡€ä¸Šå¢åŠ 1ã€‚<br>
æµ‹è¯•ç”¨ä¾‹å¦‚ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>describe('test alarm', () =&gt; {
  it('when handleCheck is clicked, show the alarm', () =&gt; {
    const wrapper = shallowMount(Home);
    const count = wrapper.vm.primaryId;
    wrapper.vm.handleCheck();
    const newCount = wrapper.vm.primaryId;
    expect(newCount).toBe(count + 1)
  })
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>è¿è¡Œ<code>yarn test:uni</code>æ—¶ä¼šå‘ç”Ÿé”™è¯¯
<img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/512eb096fd1844b49c8900c436e0f67e~tplv-k3u1fbpfcp-watermark.image" alt=""></p> <p>è¿™æ˜¯å› ä¸ºåœ¨æµ‹è¯•ä¸­ç›´æ¥æŒ‚è½½äº†ç»„ä»¶ï¼Œè€Œè¿™ä¸ªç»„ä»¶å®ä¾‹æ˜¯ä½¿ç”¨<code>Vue.extend</code>å‡½æ•°åˆ›å»ºçš„ï¼Œå¹¶åœ¨<code>main.js</code>å¼•å…¥å’Œæ·»åŠ åˆ°<code>Vue</code>çš„åŸå‹ä¸­çš„ã€‚æ¢è€Œè¨€ä¹‹ï¼Œ<code>main.js</code>å¹¶æ²¡æœ‰è¢«æ‰§è¡Œï¼Œè¿™ä¸ªç»„ä»¶å°±æ²¡æœ‰è¢«åˆ›å»ºï¼Œ<code>$alarm</code>å±æ€§å°±æ°¸è¿œä¸ä¼šè¢«æ·»åŠ ã€‚
<img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/696f8ef28fe34eeb940d479d2a28e1a1~tplv-k3u1fbpfcp-watermark.image" alt=""></p> <p>è¿™æ—¶éœ€è¦åœ¨åŠ è½½ç»„ä»¶åˆ°æµ‹è¯•ä¹‹å‰å…ˆä¸º<code>Vue</code>å®ä¾‹æ·»åŠ å±æ€§ã€‚å¯ä»¥ä½¿ç”¨<code>mocks</code>æ¥å®ç°ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>shallowMount(Home, {
  mocks: {
    $alarm: () =&gt; {}
  }
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>å†æ¬¡è¿è¡Œ<code>yarn test:uni</code>æ—¶å°±å®Œç¾çš„é€šè¿‡äº†ã€‚</p> <h3 id="æµ‹è¯•å®šæ—¶å™¨å‡½æ•°">æµ‹è¯•å®šæ—¶å™¨å‡½æ•°</h3> <p>å®šæ—¶å™¨å‡½æ•°åŒ…æ‹¬<code>JavaScript</code>å¼‚æ­¥å‡½æ•°éƒ½æ˜¯å‰ç«¯ä¸­å¸¸è§çš„åŠŸèƒ½ï¼Œæ‰€ä»¥éƒ½éœ€è¦æµ‹è¯•å¯¹åº”çš„ä»£ç ã€‚ä½†è‚¯å®šä¸æ˜¯ç­‰å¾…å®šæ—¶å™¨å‡½æ•°èµ°å®Œï¼Œéœ€è¦ä½¿ç”¨<code>Jest.useFakeTimers</code>æ›¿æ¢å…¨å±€å®šæ—¶å™¨å‡½æ•°ï¼Œæ›¿æ¢åå¯ä»¥ä½¿ç”¨<code>runTimersToTime</code>æ¨è¿›æ—¶é—´ã€‚</p> <h4 id="æµ‹è¯•settimeout">æµ‹è¯•setTimeout</h4> <p>åŠŸèƒ½ï¼š<code>handleCheck</code>äº‹ä»¶è§¦å‘åï¼Œä¼šå°†<code>alarm</code>ç»„ä»¶<code>id unshift</code>åˆ°<code>idList</code>æ•°ç»„ä¸­ï¼Œå¼¹å‡º3ç§’åç»„ä»¶å°±ä¼šè¢«é”€æ¯ï¼Œ<code>idList</code>ä¹Ÿä¼šå°†å…¶<code>id</code>ç»™åˆ é™¤æ‰ã€‚<br>
æµ‹è¯•ç”¨ä¾‹å¦‚ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>it('when handleCheck is clicked, 3second later alarm would be disappeared', () =&gt; {
  // æµ‹è¯•ä¹‹å‰ï¼Œæ›¿æ¢å…¨å±€å®šæ—¶å‡½æ•°
  jest.useFakeTimers();
  const wrapper = shallowMount(Home, {
    mocks: {
      $alarm: () =&gt; {}
    }
  });
  wrapper.vm.handleCheck();
  expect(wrapper.vm.idList.length).toBe(1);
  // å°†æ—¶é—´æ¨è¿›3000æ¯«ç§’
  jest.runTimersToTime(3000);
  expect(wrapper.vm.idList.length).toBe(0);
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="æµ‹è¯•cleartimeout">æµ‹è¯•clearTimeout</h4> <p>åŠŸèƒ½ï¼šå½“<code>alarm</code>å¼¹çª—è¶…è¿‡ä¸€ä¸ªçš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨<code>clearTimeout</code>é”€æ¯å‰ä¸€ä¸ªçš„<code>timer</code>ã€‚è¿™æ—¶å°±è¦ç›‘å¬<code>clearTimeout</code>æ˜¯å¦è¢«è°ƒç”¨ã€‚</p> <p>ä½¿ç”¨<code>Jest.spyOn</code>å‡½æ•°åˆ›å»ºä¸€ä¸ª<code>spy</code>ï¼Œå¯ä»¥ä½¿ç”¨<code>toHaveBeenCalled</code>åŒ¹é…å™¨æ¥æ£€æµ‹<code>spy</code>æ˜¯å¦è¢«è°ƒç”¨ï¼Œæ›´è¿›ä¸€æ­¥åœ°å¯ä»¥ä½¿ç”¨<code>toHaveBeenCalledWith</code>åŒ¹é…å™¨æµ‹è¯•<code>spy</code>æ˜¯å¦å¸¦æœ‰æŒ‡å®šå‚æ•°è¢«è°ƒç”¨ã€‚</p> <p>æ‰€ä»¥åœ¨æµ‹è¯•ä¸­ï¼Œéœ€è¦å¾—åˆ°<code>setTimeout</code>çš„è¿”å›å€¼ï¼Œ<code>Jest.mockReturnValue</code>å¯ä»¥å®ç°è¿™ä¸ªéœ€æ±‚ã€‚<code>mockReturnValue</code>å¯ä»¥å°†<code>setTimeout</code>çš„è¿”å›å€¼è®¾ç½®ä¸ºä»»ä½•å€¼ï¼Œæ¯”å¦‚å°†è¿”å›å€¼è®¾ç½®ä¸º123ï¼š<code>setTimeOut.mockReturnValue(123)</code><br>
æµ‹è¯•ç”¨ä¾‹å¦‚ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>it('when handleCheck is clicked and the number of alarm exceeds 1 , The previous alarm disappears immediately', () =&gt; {
    // ç›‘å¬clearTimeout
    jest.spyOn(window, 'clearTimeout')
    const wrapper = shallowMount(Home, {
      mocks: {
        $alarm: () =&gt; {}
      }
    });
    // è®¾ç½®setTimeoutè¿”å›å€¼ä¸º123
    setTimeout.mockReturnValue(123)
    wrapper.vm.handleCheck();
    // è®¾ç½®setTimeoutè¿”å›å€¼ä¸º456
    setTimeout.mockReturnValue(456)
    wrapper.vm.handleCheck();
    expect(window.clearTimeout).toHaveBeenCalledWith(123)
  })
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="æµ‹è¯•æ¨¡æ‹Ÿhttpè¯·æ±‚">æµ‹è¯•æ¨¡æ‹ŸHTTPè¯·æ±‚</h3> <p><code>HTTP</code>è¯·æ±‚ä¸åœ¨å•å…ƒæµ‹è¯•èŒƒå›´ï¼Œå› ä¸ºå®ƒä¼šé™ä½å•å…ƒæµ‹è¯•çš„é€Ÿåº¦ï¼›é™ä½å•å…ƒæµ‹è¯•çš„å¯é æ€§ï¼Œå› ä¸º<code>HTTP</code>è¯·æ±‚ä¸ä¼š100%è¯·æ±‚æˆåŠŸã€‚æ‰€ä»¥éœ€è¦åœ¨å•å…ƒæµ‹è¯•ä¸­æ¨¡æ‹Ÿ<code>api</code>æ–‡ä»¶ï¼Œä»è€Œä½¿å¾—<code>fetchAlarmDetail</code>æ°¸è¿œä¸ä¼šå‘é€ä¸€ä¸ª<code>HTTP</code>è¯·æ±‚ã€‚</p> <p><code>Jest</code>æä¾›äº†ä¸€ä¸ª<code>API</code>ï¼Œç”¨äºé€‰æ‹©å½“ä¸€ä¸ªæ¨¡å—å¯¼å…¥å¦ä¸€ä¸ªæ¨¡å—æ—¶è¿”å›å“ªäº›æ–‡ä»¶æˆ–å‡½æ•°ã€‚é¦–å…ˆçš„åˆ›å»ºä¸€ä¸ª<code>mock</code>æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨æµ‹è¯•ä¸­å¼•å…¥çœŸæ­£çš„æ–‡ä»¶ã€‚</p> <p>åœ¨<code>api</code>ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª<code>__mocks__</code>ç›®å½•ï¼Œé‡Œé¢åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„éœ€è¦æµ‹è¯•çš„<code>alarmApi</code>æ–‡ä»¶</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// src/api/__mocks__/alarmApi.js
export const fetchAlarmDetail = jest.fn(() =&gt; Promise.resolve('äººæœº'));
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ç„¶ååœ¨æµ‹è¯•æ–‡ä»¶ä¸­åŠ å…¥</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// alarm.spec.js
jest.mock('../../src/api/alarmApi.js');
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è°ƒç”¨<code>jest.mock('../../src/api/alarmApi.js')</code>åï¼Œå½“æ¨¡å—å¯¼å…¥äº†<code>src/api/alarmApi.js</code>åï¼Œ<code>Jest</code>å°†ä½¿ç”¨åˆ›å»ºçš„<code>mock</code>æ–‡ä»¶è€Œä¸æ˜¯åŸæ–‡ä»¶ã€‚</p> <p>æµ‹è¯•ç”¨ä¾‹å¦‚ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>it('fetch the alarm detail by http', async () =&gt; {
  // è®¾ç½®æ–­è¨€æ•°é‡ï¼Œå¦‚æœä¸€ä¸ªpromiseè¢«æ‹’ç»ï¼Œæµ‹è¯•ä¼šå¤±è´¥
  expect.assertions(1);
  const name = await alarmApi.fetchAlarmDetail();
  expect(name).toBe('äººæœº')
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>è®¾ç½®æ–­è¨€æ•°é‡æ˜¯åœ¨å¼‚æ­¥æµ‹è¯•ä¸­éå¸¸å¸¸ç”¨çš„æ–¹æ³•ï¼Œå› ä¸ºè¿™å¯ä»¥ç¡®ä¿åœ¨æµ‹è¯•ç»“æŸå‰æ‰§è¡Œå®Œæ‰€æœ‰æ–­è¨€ã€‚</p> <h4 id="åœ¨ç»„ä»¶ä¸­è°ƒç”¨httpè¯·æ±‚å‡½æ•°">åœ¨ç»„ä»¶ä¸­è°ƒç”¨HTTPè¯·æ±‚å‡½æ•°</h4> <p>ä¸€èˆ¬æ¥è¯´ï¼Œ<code>HTTP</code>è¯·æ±‚æ˜¯åœ¨ç»„ä»¶ä¸­ä½¿ç”¨çš„ï¼Œå•ç‹¬æµ‹è¯•ä½œç”¨å¹¶ä¸å¤§ã€‚é‚£ä¹ˆåœ¨ç»„ä»¶ä¸­è½½å…¥å…¶ä»–å¼‚æ­¥ä¾èµ–ï¼Œåº”è¯¥æ€ä¹ˆå»æµ‹è¯•å‘¢ï¼Ÿ</p> <p>é¦–å…ˆåœ¨<code>home.vue</code>ä¸­å¯¼å…¥è¯·æ±‚æ–‡ä»¶</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import * as alarmApi from '@/api/alarmApi.js';

// åœ¨handleCheckä¸­ä½¿ç”¨
async handleCheck () {
    // ...
    const name = await alarmApi.fetchAlarmDetail();
    // ...
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>å½“æµ‹è¯•è°ƒç”¨å¼‚æ­¥ä»£ç çš„æ—¶å€™ï¼Œå¹¶ä¸æ€»æ˜¯å¯ä»¥è®¿é—®éœ€è¦ç­‰å¾…çš„å¼‚æ­¥å‡½æ•°ã€‚è¿™æ„å‘³ç€ä¸èƒ½åœ¨æµ‹è¯•ä¸­ä½¿ç”¨<code>await</code>æ¥ç­‰å¾…å¼‚æ­¥å‡½æ•°ç»“æŸã€‚</p> <p>è¿™æ—¶å¯ä»¥ä½¿ç”¨<code>flush-promises</code>åº“æ¥å¸®å¿™ï¼Œå®ƒèƒ½ç­‰å¾…å¼‚æ­¥å‡½æ•°ç»“æŸã€‚ä¾‹å¦‚ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>let loading = true;
Promise.resolve().then(() =&gt; {
    loading = false;
}
await flushPromise();
expect(loading).toBe(false)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>åŸºäºæ­¤ï¼Œå°†ä¹‹å‰çš„æµ‹è¯•ç”¨ä¾‹ä¿®æ”¹ä¸ºï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 2.1
  it('when handleCheck is clicked, show the alarm', async () =&gt; {
    expect.assertions(1);
    const wrapper = shallowMount(Home, {
      mocks
    });
    const count = wrapper.vm.primaryId;
    alarmApi.fetchAlarmDetail.mockImplementationOnce(() =&gt; Promise.resolve('äººæœº'));
    wrapper.vm.handleCheck();
    await flushPromises();
    const newCount = wrapper.vm.primaryId;
    expect(newCount).toBe(count + 1)
  })
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>åŠ å…¥ä¸€ä¸ª<code>expect.assertions(1)</code>è®¾ç½®æ–­è¨€æ•°é‡ï¼Œè®¾ç½®<code>fetchAlarmDetail</code>å‡½æ•°çš„è¿”å›ç»“æœï¼Œæœ€åè°ƒç”¨<code>await flushPromises();</code>ç­‰å¾…æ‰€æœ‰å¼‚æ­¥å‡½æ•°ç»“æŸã€‚ï¼ˆä¹‹åçš„æµ‹è¯•ç”¨ä¾‹ä¿®æ”¹ï¼Œä¸å†å±•å¼€è®¨è®ºï¼Œè¯¦æƒ…è¯·çœ‹ä»£ç ã€‚ï¼‰</p> <p>åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥<code>yarn test:uni</code> <img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cff34a12d99e428c9bb1d62160e7ea63~tplv-k3u1fbpfcp-watermark.image" alt=""></p> <h3 id="æµ‹è¯•äº‹ä»¶">æµ‹è¯•äº‹ä»¶</h3> <h4 id="æµ‹è¯•domäº‹ä»¶">æµ‹è¯•DOMäº‹ä»¶</h4> <p>åŠŸèƒ½ï¼šç‚¹å‡»ä¸€ä¸ªæŒ‰é’®ï¼Œè§¦å‘ä¸€ä¸ª<code>click</code>äº‹ä»¶
æµ‹è¯•ç”¨ä¾‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>it('click the button then the $alarm will be called', () =&gt; {
  const wrapper = shallowMount(Home, {
    mocks
  });
  wrapper.find('button.check').trigger('click');
  expect($alarm).toHaveBeenCalled();
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>æ¯ä¸ªåŒ…è£…å™¨éƒ½æœ‰ä¸€ä¸ª<code>trigger</code>æ–¹æ³•ï¼Œç”¨äºåœ¨åŒ…è£…å™¨ä¸Šåˆ†å‘ä¸€ä¸ªäº‹ä»¶ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// é”®ç›˜äº‹ä»¶
wrapper.trigger('keydown.up')ï¼›
wrapper.trigger('keydown', {
  key: 'a'
})
// é¼ æ ‡äº‹ä»¶
wrapper.trigger('mouseenter')ï¼›
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="æµ‹è¯•è‡ªå®šä¹‰äº‹ä»¶">æµ‹è¯•è‡ªå®šä¹‰äº‹ä»¶</h4> <p><code>VUE</code>è‡ªå®šä¹‰äº‹ä»¶æ˜¯ç”±å¸¦æœ‰<code>VUE</code>å®ä¾‹<code>$emit</code>æ–¹æ³•çš„ç»„ä»¶äº‹ä»¶å‘å°„å‡ºå»çš„ã€‚åœ¨å­ç»„ä»¶ä¸­å‘å°„ä¸€ä¸ªäº‹ä»¶ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// son.vue
this.$emit('eventName', payload);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>åœ¨çˆ¶ç»„ä»¶ä¸­æ¥æ”¶ä¸€ä¸ªäº‹ä»¶ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// father
&lt;son @eventName='handleEvent'&gt;&lt;/son&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>åŠŸèƒ½ï¼š ç‚¹å‡»ä½äº<code>HelloWorld</code>ç»„ä»¶çš„<code>class</code>ä¸º<code>hello</code>çš„<code>button</code>å…ƒç´ ï¼Œè§¦å‘<code>sayHello</code>äº‹ä»¶å¹¶æºå¸¦<code>hello</code>ã€‚ä½äº<code>Home</code>ç»„ä»¶çš„<code>handleSayHello</code>è§¦å‘ï¼Œå°†<code>greeting</code>ä»<code>hi</code>å˜æˆ<code>hello</code>ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>it('click the check button, home.greeting will change to hello', () =&gt; {
    const wrapper = shallowMount(Home);
    wrapper.findComponent(Hello).vm.$emit('sayHello', 'hello');
    expect(wrapper.vm.greeting).toBe('hello')
  })
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/FEBlog/assets/js/app.b158500d.js" defer></script><script src="/FEBlog/assets/js/2.7d7fb6cb.js" defer></script><script src="/FEBlog/assets/js/38.ebd67282.js" defer></script>
  </body>
</html>
