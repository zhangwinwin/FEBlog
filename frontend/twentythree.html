<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>挖掘隐藏在源码中的Vue技巧！ | zhangwinwin&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">
    <link rel="stylesheet" href="https://gitcdn.xyz/cdn/goessner/markdown-it-texmath/master/texmath.css">
    <script src="https://github.com/markdown-it/markdown-it/blob/master/bin/markdown-it.js"></script>
    <script src="https://gitcdn.xyz/cdn/goessner/markdown-it-texmath/master/texmath.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
    <meta name="description" content="some technical articles on programming, especially webgl">
    
    <link rel="preload" href="/FEBlog/assets/css/0.styles.d6193a66.css" as="style"><link rel="preload" href="/FEBlog/assets/js/app.b158500d.js" as="script"><link rel="preload" href="/FEBlog/assets/js/2.7d7fb6cb.js" as="script"><link rel="preload" href="/FEBlog/assets/js/45.ad1d828c.js" as="script"><link rel="prefetch" href="/FEBlog/assets/js/10.f2a2cc76.js"><link rel="prefetch" href="/FEBlog/assets/js/11.9d2c86e2.js"><link rel="prefetch" href="/FEBlog/assets/js/12.b8ebcb32.js"><link rel="prefetch" href="/FEBlog/assets/js/13.c4ca47c5.js"><link rel="prefetch" href="/FEBlog/assets/js/14.a3911fae.js"><link rel="prefetch" href="/FEBlog/assets/js/15.f3798b20.js"><link rel="prefetch" href="/FEBlog/assets/js/16.3988fd0d.js"><link rel="prefetch" href="/FEBlog/assets/js/17.a3bff097.js"><link rel="prefetch" href="/FEBlog/assets/js/18.0402de45.js"><link rel="prefetch" href="/FEBlog/assets/js/19.64dfd7bd.js"><link rel="prefetch" href="/FEBlog/assets/js/20.8ae18d54.js"><link rel="prefetch" href="/FEBlog/assets/js/21.686fbff4.js"><link rel="prefetch" href="/FEBlog/assets/js/22.f37786bd.js"><link rel="prefetch" href="/FEBlog/assets/js/23.d01475c6.js"><link rel="prefetch" href="/FEBlog/assets/js/24.b50cb274.js"><link rel="prefetch" href="/FEBlog/assets/js/25.dec00c3c.js"><link rel="prefetch" href="/FEBlog/assets/js/26.be064a51.js"><link rel="prefetch" href="/FEBlog/assets/js/27.204b551b.js"><link rel="prefetch" href="/FEBlog/assets/js/28.843b63a9.js"><link rel="prefetch" href="/FEBlog/assets/js/29.58e09b07.js"><link rel="prefetch" href="/FEBlog/assets/js/3.65fb9823.js"><link rel="prefetch" href="/FEBlog/assets/js/30.68fadd92.js"><link rel="prefetch" href="/FEBlog/assets/js/31.da110779.js"><link rel="prefetch" href="/FEBlog/assets/js/32.fd8ecdbf.js"><link rel="prefetch" href="/FEBlog/assets/js/33.ab43cbf0.js"><link rel="prefetch" href="/FEBlog/assets/js/34.9eb09d94.js"><link rel="prefetch" href="/FEBlog/assets/js/35.d24309ed.js"><link rel="prefetch" href="/FEBlog/assets/js/36.2b760384.js"><link rel="prefetch" href="/FEBlog/assets/js/37.cf57d516.js"><link rel="prefetch" href="/FEBlog/assets/js/38.ebd67282.js"><link rel="prefetch" href="/FEBlog/assets/js/39.390dc348.js"><link rel="prefetch" href="/FEBlog/assets/js/4.6e58adc1.js"><link rel="prefetch" href="/FEBlog/assets/js/40.9dba16d5.js"><link rel="prefetch" href="/FEBlog/assets/js/41.a3240bd5.js"><link rel="prefetch" href="/FEBlog/assets/js/42.eb5be3bf.js"><link rel="prefetch" href="/FEBlog/assets/js/43.730ebcf4.js"><link rel="prefetch" href="/FEBlog/assets/js/44.ccc62d57.js"><link rel="prefetch" href="/FEBlog/assets/js/46.5b36dcbd.js"><link rel="prefetch" href="/FEBlog/assets/js/47.4a801f44.js"><link rel="prefetch" href="/FEBlog/assets/js/48.7e166c43.js"><link rel="prefetch" href="/FEBlog/assets/js/49.23c05926.js"><link rel="prefetch" href="/FEBlog/assets/js/5.720089dd.js"><link rel="prefetch" href="/FEBlog/assets/js/50.4e03a0f5.js"><link rel="prefetch" href="/FEBlog/assets/js/51.e42c88ba.js"><link rel="prefetch" href="/FEBlog/assets/js/52.f07316b9.js"><link rel="prefetch" href="/FEBlog/assets/js/53.eb8ab9b1.js"><link rel="prefetch" href="/FEBlog/assets/js/54.4cd69611.js"><link rel="prefetch" href="/FEBlog/assets/js/55.d67f2251.js"><link rel="prefetch" href="/FEBlog/assets/js/56.0e8e4426.js"><link rel="prefetch" href="/FEBlog/assets/js/57.e6a8e7d6.js"><link rel="prefetch" href="/FEBlog/assets/js/58.4cf7f096.js"><link rel="prefetch" href="/FEBlog/assets/js/59.fd6482f8.js"><link rel="prefetch" href="/FEBlog/assets/js/6.837ac311.js"><link rel="prefetch" href="/FEBlog/assets/js/60.3ce8a368.js"><link rel="prefetch" href="/FEBlog/assets/js/61.3162b2a8.js"><link rel="prefetch" href="/FEBlog/assets/js/62.ced16e8f.js"><link rel="prefetch" href="/FEBlog/assets/js/63.645bd795.js"><link rel="prefetch" href="/FEBlog/assets/js/64.4f65269b.js"><link rel="prefetch" href="/FEBlog/assets/js/65.14527b40.js"><link rel="prefetch" href="/FEBlog/assets/js/66.e572cb43.js"><link rel="prefetch" href="/FEBlog/assets/js/7.f30bf9bf.js"><link rel="prefetch" href="/FEBlog/assets/js/8.2380c336.js"><link rel="prefetch" href="/FEBlog/assets/js/9.f775cc22.js">
    <link rel="stylesheet" href="/FEBlog/assets/css/0.styles.d6193a66.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/FEBlog/" class="home-link router-link-active"><!----> <span class="site-name">zhangwinwin's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/FEBlog/" class="nav-link">
  Intro
</a></div><div class="nav-item"><a href="/FEBlog/webgl/" class="nav-link">
  Webgl
</a></div><div class="nav-item"><a href="/FEBlog/frontend/" class="nav-link router-link-active">
  Frontend
</a></div><div class="nav-item"><a href="/FEBlog/network/" class="nav-link">
  Network
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客地址" class="dropdown-title"><span class="title">博客地址</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客地址" class="mobile-dropdown-title"><span class="title">博客地址</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zhangwinwin/FEBlog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1486195453331757" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/FEBlog/" class="nav-link">
  Intro
</a></div><div class="nav-item"><a href="/FEBlog/webgl/" class="nav-link">
  Webgl
</a></div><div class="nav-item"><a href="/FEBlog/frontend/" class="nav-link router-link-active">
  Frontend
</a></div><div class="nav-item"><a href="/FEBlog/network/" class="nav-link">
  Network
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客地址" class="dropdown-title"><span class="title">博客地址</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客地址" class="mobile-dropdown-title"><span class="title">博客地址</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zhangwinwin/FEBlog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1486195453331757" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><section id="nice" data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="font-size:16px;padding:0 10px;word-spacing:0px;word-break:break-word;word-wrap:break-word;text-align:left;line-height:1.75;color:#595959;font-family:Optima-Regular, Optima, PingFangTC-Light, PingFangSC-light, PingFangTC-light;letter-spacing:2px;background-image:linear-gradient(90deg, rgba(50, 0, 0, 0.05) 3%, rgba(0, 0, 0, 0) 3%), linear-gradient(360deg, rgba(50, 0, 0, 0.05) 3%, rgba(0, 0, 0, 0) 3%);background-size:20px 20px;background-position:center center;"><h2 data-tool="mdnice编辑器" style="margin-top:30px;margin-bottom:15px;padding:0px;font-weight:bold;color:black;font-size:22px;text-align:left;margin:20px 10px 0px 0px;"><span class="prefix" style="display:none;"></span><span class="content" style="font-size:18px;font-weight:bold;display:inline-block;padding-left:10px;border-left:5px solid #DEC6FB;color:#595959;">前言</span><span class="suffix"></span></h2> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">最近关于<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">Vue</code>的技巧文章大热，我自己也写过一篇<a href="https://juejin.im/post/6844904132193566728" style="text-decoration:none;word-wrap:break-word;color:#664D9D;font-weight:normal;border-bottom:1px solid #664D9D;">(vue开发中的&quot;骚操作&quot;)</a>，但这篇文章的技巧是能在<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">Vue</code>的文档中找到蛛丝马迹的，而有些文章说的技巧在<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">Vue</code>文档中根本找不到踪迹！这是为什么呢？</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">当我开始阅读源码的时候，我才发现，其实这些所谓的技巧就是对源码的理解而已。</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">下面我分享一下我的收获。</p> <h2 data-tool="mdnice编辑器" style="margin-top:30px;margin-bottom:15px;padding:0px;font-weight:bold;color:black;font-size:22px;text-align:left;margin:20px 10px 0px 0px;"><span class="prefix" style="display:none;"></span><span class="content" style="font-size:18px;font-weight:bold;display:inline-block;padding-left:10px;border-left:5px solid #DEC6FB;color:#595959;">隐藏在源码中的技巧</span><span class="suffix"></span></h2> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">我们知道，在使用<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">Vue</code>时，要使用<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">new</code>关键字进行调用，这就说明<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">Vue</code>是一个构造函数。所以源头就是定义<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">Vue</code>构造函数的地方！</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">在<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">src/core/instance/index.js</code>中找到了这个构造函数</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> Vue (options) {
<span></span>  <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">if</span> (process.env.NODE_ENV !== <span class="hljs-string" style="color:#D69D85;line-height:26px;">'production'</span> &amp;&amp;
<span></span>    !(this instanceof Vue)
<span></span>  ) {
<span></span>    warn(<span class="hljs-string" style="color:#D69D85;line-height:26px;">'Vue is a constructor and should be called with the `new` keyword'</span>)
<span></span>  }
<span></span>  this._init(options)
<span></span>}
<span></span>initMixin(Vue)
<span></span>stateMixin(Vue)
<span></span>eventsMixin(Vue)
<span></span>lifecycleMixin(Vue)
<span></span>renderMixin(Vue)
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">在构造函数中，只做一件事——执行<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">this._init(options)</code>。</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">而<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">_init()</code>函数是在<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">initMixin(Vue)</code>中定义的</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;"><span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">export</span> <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> initMixin (Vue: Class&lt;Component&gt;) {
<span></span>  Vue.prototype._init = <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> (options?: Object) {
<span></span>    // ... _init 方法的函数体，此处省略
<span></span>  }
<span></span>}
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">以此为主线，来看看在这过程中有什么好玩的技巧。</p> <h3 data-tool="mdnice编辑器" style="margin-top:30px;margin-bottom:15px;padding:0px;color:black;font-size:16px;font-weight:bold;text-align:center;"><span class="prefix" style="display:none;"></span><span class="content" style="border-bottom:2px solid #DEC6FB;color:#595959;">解构赋值子组件data的参数</span><span class="suffix" style="display:none;"></span></h3> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">按照官方文档，我们一般是这样写子组件<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">data</code>选项的：</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;">props: [<span class="hljs-string" style="color:#D69D85;line-height:26px;">'parentData'</span>],
<span></span><span class="hljs-function" style="color:#DCDCDC;line-height:26px;"><span class="hljs-title" style="color:#DCDCDC;line-height:26px;">data</span></span> () {
<span></span>  <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">return</span> {
<span></span>    childData: this.parentData
<span></span>  }
<span></span>}
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">但你知道吗，也是可以这么写：</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;">data (vm) {
<span></span>  <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">return</span> {
<span></span>    <span class="hljs-attr" style="color:#9CDCFE;line-height:26px;">childData</span>: vm.parentData
<span></span>  }
<span></span>}
<span></span><span class="hljs-comment" style="color:#57A64A;font-style:italic;line-height:26px;">// 或者使用解构赋值</span>
<span></span>data ({ parentData }) {
<span></span>  <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">return</span> {
<span></span>    <span class="hljs-attr" style="color:#9CDCFE;line-height:26px;">childData</span>: parentData
<span></span>  }
<span></span>}
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">通过解构赋值的方式将<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">props</code>里的变量传给<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">data</code>函数中，也就是说 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">data</code> 函数的参数就是当前实例对象。</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">这是因为<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">data</code>函数的执行是用<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">call()</code>方法强制绑定了当前实例对象。这发生在<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">data</code>合并的阶段，接下来去看看，说不定还有一些别的收获！</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">在<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">_init()</code>函数中主要是执行一系列的初始化，其中<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">options</code>选项的合并是初始化的基础。</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;">vm.<span class="hljs-variable" style="color:#BD63C5;line-height:26px;">$options</span> = mergeOptions(
<span></span>    resolveConstructorOptions(vm.constructor),
<span></span>    options || {},
<span></span>    vm
<span></span>)
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">在<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">Vue</code>实例上添加了<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">$options</code>属性，在那些初始化方法中，无一例外的都使用到了实例的<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">$options</code>属性，即<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">vm.$options</code>。</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">其中合并<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">data</code>就是在<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">mergeOption</code>中进行的。</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;">strats.data = <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> (
<span></span>  parentVal: any,
<span></span>  childVal: any,
<span></span>  vm?: Component
<span></span>): ?Function {
<span></span>  <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">if</span> (!vm) {
<span></span>    <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">if</span> (childVal &amp;&amp; typeof childVal !== <span class="hljs-string" style="color:#D69D85;line-height:26px;">'function'</span>) {
<span></span>      process.env.NODE_ENV !== <span class="hljs-string" style="color:#D69D85;line-height:26px;">'production'</span> &amp;&amp; warn(
<span></span>        <span class="hljs-string" style="color:#D69D85;line-height:26px;">'The &quot;data&quot; option should be a function '</span> +
<span></span>        <span class="hljs-string" style="color:#D69D85;line-height:26px;">'that returns a per-instance value in component '</span> +
<span></span>        <span class="hljs-string" style="color:#D69D85;line-height:26px;">'definitions.'</span>,
<span></span>        vm
<span></span>      )
<span></span>
<span></span>      <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">return</span> parentVal
<span></span>    }
<span></span>    <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">return</span> mergeDataOrFn(parentVal, childVal)
<span></span>  }
<span></span>
<span></span>  <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">return</span> mergeDataOrFn(parentVal, childVal, vm)
<span></span>}
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">上面代码是<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">data</code>选项的合并策略函数，首先通过判断是否存在<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">vm</code>，来判断是否为父子组件，存在<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">vm</code>则为父组件。不管怎么，最后都是返回<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">mergeDataOrFn</code>的执行结果。区别在于处理父组件时，透传<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">vm</code>。</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">接下来看看<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">mergeDataOrFn</code>函数。</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;"><span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">export</span> <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> mergeDataOrFn (
<span></span>  parentVal: any,
<span></span>  childVal: any,
<span></span>  vm?: Component
<span></span>): ?Function {
<span></span>  <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">if</span> (!vm) {
<span></span>    // <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">in</span> a Vue.extend merge, both should be <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">functions</span>
<span></span>    <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">if</span> (!childVal) {
<span></span>      <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">return</span> parentVal
<span></span>    }
<span></span>    <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">if</span> (!parentVal) {
<span></span>      <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">return</span> childVal
<span></span>    }
<span></span>    // when parentVal &amp; childVal are both present,
<span></span>    // we need to <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">return</span> a <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> that returns the
<span></span>    // merged result of both <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">functions</span>... no need to
<span></span>    // check <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">if</span> parentVal is a <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> here because
<span></span>    // it has to be a <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> to pass previous merges.
<span></span>    <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">return</span> <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> <span class="hljs-function" style="color:#DCDCDC;line-height:26px;"><span class="hljs-title" style="color:#DCDCDC;line-height:26px;">mergedDataFn</span></span> () {
<span></span>      <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">return</span> mergeData(
<span></span>        typeof childVal === <span class="hljs-string" style="color:#D69D85;line-height:26px;">'function'</span> ? childVal.call(this, this) : childVal,
<span></span>        typeof parentVal === <span class="hljs-string" style="color:#D69D85;line-height:26px;">'function'</span> ? parentVal.call(this, this) : parentVal
<span></span>      )
<span></span>    }
<span></span>  } <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">else</span> {
<span></span>    <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">return</span> <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> <span class="hljs-function" style="color:#DCDCDC;line-height:26px;"><span class="hljs-title" style="color:#DCDCDC;line-height:26px;">mergedInstanceDataFn</span></span> () {
<span></span>      // instance merge
<span></span>      const instanceData = typeof childVal === <span class="hljs-string" style="color:#D69D85;line-height:26px;">'function'</span>
<span></span>        ? childVal.call(vm, vm)
<span></span>        : childVal
<span></span>      const defaultData = typeof parentVal === <span class="hljs-string" style="color:#D69D85;line-height:26px;">'function'</span>
<span></span>        ? parentVal.call(vm, vm)
<span></span>        : parentVal
<span></span>      <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">if</span> (instanceData) {
<span></span>        <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">return</span> mergeData(instanceData, defaultData)
<span></span>      } <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">else</span> {
<span></span>        <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">return</span> defaultData
<span></span>      }
<span></span>    }
<span></span>  }
<span></span>}
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">函数整体是由<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">if</code>判断分支语句块组成，对<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">vm</code>进行判断，也使得<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">mergeDataOrFn</code>也能区分父子组件。</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;"><span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">return</span> <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> <span class="hljs-function" style="color:#DCDCDC;line-height:26px;"><span class="hljs-title" style="color:#DCDCDC;line-height:26px;">mergedDataFn</span></span> () {
<span></span>  <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">return</span> mergeData(
<span></span>    typeof childVal === <span class="hljs-string" style="color:#D69D85;line-height:26px;">'function'</span> ? childVal.call(this, this) : childVal,
<span></span>    typeof parentVal === <span class="hljs-string" style="color:#D69D85;line-height:26px;">'function'</span> ? parentVal.call(this, this) : parentVal
<span></span>  )
<span></span>}
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">来看这一段，当父子组件的<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">data</code>选项同时存在，那么就返回<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">mergedDataFn</code>函数。<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">mergedDataFn</code>函数又返回<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">mergeData</code>函数。</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">在mergeData函数中，执行父子组件的<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">data</code>选项函数，注意这里的 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">childVal.call(this, this)</code> 和 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">parentVal.call(this, this)</code>，关键在于 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">call(this, this)</code>，可以看到，第一个 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">this</code> 指定了 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">data</code> 函数的作用域，而第二个 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">this</code> 就是传递给 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">data</code> 函数的参数。这就是开头能用解构赋值的原理。</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">接着往下看！</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">注意因为函数已经返回了<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">(return)</code>，所以<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">mergedDataFn</code>函数还没有执行。</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">以上就是处理子组件的<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">data</code>选项时所做的事，可以发现在处理子组件选项时返回的总是一个函数。</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">说完了处理子组件选项的情况，再看看处理非子组件选项的情况，也就是使用 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">new</code> 操作符创建实例时的情况。</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">if</span> (!vm) {
<span></span>  ...
<span></span>} <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">else</span> {
<span></span>  <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">return</span> <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> <span class="hljs-function" style="color:#DCDCDC;line-height:26px;"><span class="hljs-title" style="color:#DCDCDC;line-height:26px;">mergedInstanceDataFn</span></span> () {
<span></span>    // instance merge
<span></span>    const instanceData = typeof childVal === <span class="hljs-string" style="color:#D69D85;line-height:26px;">'function'</span>
<span></span>      ? childVal.call(vm, vm)
<span></span>      : childVal
<span></span>    const defaultData = typeof parentVal === <span class="hljs-string" style="color:#D69D85;line-height:26px;">'function'</span>
<span></span>      ? parentVal.call(vm, vm)
<span></span>      : parentVal
<span></span>    <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">if</span> (instanceData) {
<span></span>      <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">return</span> mergeData(instanceData, defaultData)
<span></span>    } <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">else</span> {
<span></span>      <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">return</span> defaultData
<span></span>    }
<span></span>  }
<span></span>}
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">如果走<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">else</code>分支的话那么就直接返回<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">mergedInstanceDataFn</code>函数。其中父子组件<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">data</code>选项函数的执行也是用了<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">call(vm, vm)</code>方法，强制绑定当前实例对象。</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;">const instanceData = typeof childVal === <span class="hljs-string" style="color:#D69D85;line-height:26px;">'function'</span>
<span></span>  ? childVal.call(vm, vm)
<span></span>  : childVal
<span></span>const defaultData = typeof parentVal === <span class="hljs-string" style="color:#D69D85;line-height:26px;">'function'</span>
<span></span>  ? parentVal.call(vm, vm)
<span></span>  : parentVal
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">注意此时的<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">mergedInstanceDataFn</code>函数同样还没有执行。所以<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">mergeDataFn</code>函数永远返回一个函数。</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">为什么这么强调返回的是一个函数呢？也就是说<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">strats.data</code>最终结果是一个函数？</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">这是因为，通过函数返回的数据对象，保证了每个组件实例都要有一个唯一的数据副本，避免了组件间数据互相影响。</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">这个<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">mergeDataFn</code>就是后面的初始化阶段处理执行的。<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">mergeDataFn</code>返回是<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">mergeData(childVal, parentVal)</code>的执行结果才是真正合并父子组件的<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">data</code>选项。也就是到了初始化阶段才是真正合并，这是因为<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">props</code>和<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">inject</code>这两个选项的初始化是先于<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">data</code>选项的，这就保证了能够使用<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">props</code>初始化<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">data</code>中的数据。</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">这才能在<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">data</code>选项中调用<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">props</code>或者<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">inject</code>的值！</p> <h3 data-tool="mdnice编辑器" style="margin-top:30px;margin-bottom:15px;padding:0px;color:black;font-size:16px;font-weight:bold;text-align:center;"><span class="prefix" style="display:none;"></span><span class="content" style="border-bottom:2px solid #DEC6FB;color:#595959;">生命周期钩子可以写成数组形式</span><span class="suffix" style="display:none;"></span></h3> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">生命周期钩子可以写成数组形式，不信你可以试试！</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;">created: [
<span></span>    <span class="hljs-function" style="color:#DCDCDC;line-height:26px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> (<span class="hljs-params" style="color:#DCDCDC;line-height:26px;"></span>) </span>{
<span></span>      <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">console</span>.log(<span class="hljs-string" style="color:#D69D85;line-height:26px;">'first'</span>)
<span></span>    },
<span></span>    <span class="hljs-function" style="color:#DCDCDC;line-height:26px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> (<span class="hljs-params" style="color:#DCDCDC;line-height:26px;"></span>) </span>{
<span></span>      <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">console</span>.log(<span class="hljs-string" style="color:#D69D85;line-height:26px;">'second'</span>)
<span></span>    },
<span></span>    <span class="hljs-function" style="color:#DCDCDC;line-height:26px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> (<span class="hljs-params" style="color:#DCDCDC;line-height:26px;"></span>) </span>{
<span></span>      <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">console</span>.log(<span class="hljs-string" style="color:#D69D85;line-height:26px;">'third'</span>)
<span></span>    }
<span></span>]
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">这啥能这么写？来看看生命周期钩子的合并处理！</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">mergeHook是用于合并生命周期钩子。</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;"><span class="hljs-comment" style="color:#57A64A;font-style:italic;line-height:26px;">/**
<span></span> * Hooks and props are merged as arrays.
<span></span> */</span>
<span></span><span class="hljs-function" style="color:#DCDCDC;line-height:26px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> <span class="hljs-title" style="color:#DCDCDC;line-height:26px;">mergeHook</span> (<span class="hljs-params" style="color:#DCDCDC;line-height:26px;">
<span></span>  parentVal: ?Array&lt;Function&gt;,
<span></span>  childVal: ?Function | ?Array&lt;Function&gt;
<span></span></span>): ?<span class="hljs-title" style="color:#DCDCDC;line-height:26px;">Array</span>&lt;<span class="hljs-title" style="color:#DCDCDC;line-height:26px;">Function</span>&gt; </span>{
<span></span>  <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">return</span> childVal
<span></span>    ? parentVal
<span></span>      ? parentVal.concat(childVal)
<span></span>      : <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">Array</span>.isArray(childVal)
<span></span>        ? childVal
<span></span>        : [childVal]
<span></span>    : parentVal
<span></span>}
<span></span>
<span></span>LIFECYCLE_HOOKS.forEach(<span class="hljs-function" style="color:#DCDCDC;line-height:26px;"><span class="hljs-params" style="color:#DCDCDC;line-height:26px;">hook</span> =&gt;</span> {
<span></span>  strats[hook] = mergeHook
<span></span>})
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">其实从注释中也能发现<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">Hooks and props are merged as arrays</code>.</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">使用<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">forEach</code>遍历<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">LIFECYCLE_HOOKS</code>常量，说明<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">LIFECYCLE_HOOKS</code>是一个数组。<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">LIFECYCLE_HOOKS</code>来自于<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">shared/constants.js</code>文件。</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;"><span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">export</span> const LIFECYCLE_HOOKS = [
<span></span>  <span class="hljs-string" style="color:#D69D85;line-height:26px;">'beforeCreate'</span>,
<span></span>  <span class="hljs-string" style="color:#D69D85;line-height:26px;">'created'</span>,
<span></span>  <span class="hljs-string" style="color:#D69D85;line-height:26px;">'beforeMount'</span>,
<span></span>  <span class="hljs-string" style="color:#D69D85;line-height:26px;">'mounted'</span>,
<span></span>  <span class="hljs-string" style="color:#D69D85;line-height:26px;">'beforeUpdate'</span>,
<span></span>  <span class="hljs-string" style="color:#D69D85;line-height:26px;">'updated'</span>,
<span></span>  <span class="hljs-string" style="color:#D69D85;line-height:26px;">'beforeDestroy'</span>,
<span></span>  <span class="hljs-string" style="color:#D69D85;line-height:26px;">'destroyed'</span>,
<span></span>  <span class="hljs-string" style="color:#D69D85;line-height:26px;">'activated'</span>,
<span></span>  <span class="hljs-string" style="color:#D69D85;line-height:26px;">'deactivated'</span>,
<span></span>  <span class="hljs-string" style="color:#D69D85;line-height:26px;">'errorCaptured'</span>
<span></span>]
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">所以那段<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">forEach</code>语句，它的作用就是在<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">strats</code>策略对象上添加用来合并各个生命周期钩子选项的函数。</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;"><span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">return</span> childVal
<span></span>    ? parentVal
<span></span>      ? parentVal.concat(childVal)
<span></span>      : Array.isArray(childVal)
<span></span>        ? childVal
<span></span>        : [childVal]
<span></span>    : parentVal
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">函数体由三组三目运算符组成，在经过 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">mergeHook</code> 函数处理之后，组件选项的生命周期钩子函数被合并成一个数组。</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">在第一个三目运算符中，首先判断是否有 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">childVal</code>，即组件的选项是否写了生命周期钩子函数，如果没有则直接返回了 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">parentVal</code>，这里有一个预设的假定，就是如果有 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">parentVal</code> 那么一定是个数组，如果没有 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">parentVal</code> 那么 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">strats[hooks]</code> 函数根本不会执行。以 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">created</code> 生命周期钩子函数为例：</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">new</span> Vue({
<span></span>    <span class="hljs-attr" style="color:#9CDCFE;line-height:26px;">created</span>: <span class="hljs-function" style="color:#DCDCDC;line-height:26px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> (<span class="hljs-params" style="color:#DCDCDC;line-height:26px;"></span>) </span>{
<span></span>        <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">console</span>.log(<span class="hljs-string" style="color:#D69D85;line-height:26px;">'created'</span>)
<span></span>    }
<span></span>})
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">对于 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">strats.created</code> 策略函数来讲，<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">childVal</code> 就是例子中的 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">created</code> 选项，它是一个函数。<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">parentVal</code> 应该是 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">Vue.options.created</code>，但 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">Vue.options.created</code> 是不存在的，所以最终经过 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">strats.created</code> 函数的处理将返回一个数组：</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;">options.created = [
<span></span>  <span class="hljs-function" style="color:#DCDCDC;line-height:26px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> (<span class="hljs-params" style="color:#DCDCDC;line-height:26px;"></span>) </span>{
<span></span>    <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">console</span>.log(<span class="hljs-string" style="color:#D69D85;line-height:26px;">'created'</span>)
<span></span>  }  
<span></span>]
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">再看下面的例子：</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">const</span> Parent = Vue.extend({
<span></span>  <span class="hljs-attr" style="color:#9CDCFE;line-height:26px;">created</span>: <span class="hljs-function" style="color:#DCDCDC;line-height:26px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> (<span class="hljs-params" style="color:#DCDCDC;line-height:26px;"></span>) </span>{
<span></span>    <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">console</span>.log(<span class="hljs-string" style="color:#D69D85;line-height:26px;">'parentVal'</span>)
<span></span>  }
<span></span>})
<span></span>
<span></span><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">const</span> Child = <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">new</span> Parent({
<span></span>  <span class="hljs-attr" style="color:#9CDCFE;line-height:26px;">created</span>: <span class="hljs-function" style="color:#DCDCDC;line-height:26px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> (<span class="hljs-params" style="color:#DCDCDC;line-height:26px;"></span>) </span>{
<span></span>    <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">console</span>.log(<span class="hljs-string" style="color:#D69D85;line-height:26px;">'childVal'</span>)
<span></span>  }
<span></span>})
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">其中 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">Child</code> 是使用 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">new Parent</code> 生成的，所以对于 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">Child</code> 来讲，<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">childVal</code> 是：</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;">created: <span class="hljs-function" style="color:#DCDCDC;line-height:26px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> (<span class="hljs-params" style="color:#DCDCDC;line-height:26px;"></span>) </span>{
<span></span>  <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">console</span>.log(<span class="hljs-string" style="color:#D69D85;line-height:26px;">'childVal'</span>)
<span></span>}
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">而 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">parentVal</code> 已经不是 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">Vue.options.created</code> 了，而是 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">Parent.options.created</code>，那么 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">Parent.options.created</code> 是什么呢？它其实是通过 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">Vue.extend</code> 函数内部的 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">mergeOptions</code> 处理过的，所以它应该是这样的：</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;">Parent.options.created = [
<span></span>  created: <span class="hljs-function" style="color:#DCDCDC;line-height:26px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> (<span class="hljs-params" style="color:#DCDCDC;line-height:26px;"></span>) </span>{
<span></span>    <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">console</span>.log(<span class="hljs-string" style="color:#D69D85;line-height:26px;">'parentVal'</span>)
<span></span>  }
<span></span>]
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">经过mergeHook函数处理，关键在那句：<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">parentVal.concat(childVal)</code>，将 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">parentVal</code> 和 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">childVal</code> 合并成一个数组。所以最终结果如下：</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;">[
<span></span>  created: <span class="hljs-function" style="color:#DCDCDC;line-height:26px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> (<span class="hljs-params" style="color:#DCDCDC;line-height:26px;"></span>) </span>{
<span></span>    <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">console</span>.log(<span class="hljs-string" style="color:#D69D85;line-height:26px;">'parentVal'</span>)
<span></span>  },
<span></span>  <span class="hljs-attr" style="color:#9CDCFE;line-height:26px;">created</span>: <span class="hljs-function" style="color:#DCDCDC;line-height:26px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> (<span class="hljs-params" style="color:#DCDCDC;line-height:26px;"></span>) </span>{
<span></span>    <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">console</span>.log(<span class="hljs-string" style="color:#D69D85;line-height:26px;">'childVal'</span>)
<span></span>  }
<span></span>]
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">另外注意第三个三目运算符：</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;">: <span class="hljs-built_in" style="color:#4EC9B0;line-height:26px;">Array</span>.isArray(childVal)
<span></span>  ? childVal
<span></span>  : [childVal]
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">它判断了 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">childVal</code> 是不是数组，这说明了生命周期钩子是可以写成数组的。这就是开头所说的原理！</p> <h3 data-tool="mdnice编辑器" style="margin-top:30px;margin-bottom:15px;padding:0px;color:black;font-size:16px;font-weight:bold;text-align:center;"><span class="prefix" style="display:none;"></span><span class="content" style="border-bottom:2px solid #DEC6FB;color:#595959;">生命周期钩子的事件侦听器</span><span class="suffix" style="display:none;"></span></h3> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">大家可能不知道什么叫做<strong style="color:#595959;font-weight:bold;"><span>「</span>生命周期钩子的事件侦听器<span>」</span></strong>？，其实<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">Vue</code>组件是可以这么写的：</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;"><span class="hljs-tag" style="color:#9B9B9B;line-height:26px;">&lt;<span class="hljs-name" style="color:#569CD6;line-height:26px;">child</span>
<span></span>  @<span class="hljs-attr" style="color:#9CDCFE;line-height:26px;">hook:created</span>=<span class="hljs-string" style="color:#D69D85;line-height:26px;">&quot;childCreated&quot;</span>
<span></span>  @<span class="hljs-attr" style="color:#9CDCFE;line-height:26px;">hook:mounted</span>=<span class="hljs-string" style="color:#D69D85;line-height:26px;">&quot;childMounted&quot;</span>
<span></span> /&gt;</span>
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">在初始化中，使用<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">callhook(vm, 'created')</code>函数执行<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">created</code>生命周期函数，接下来瞧一瞧<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">callhook()</code>的实现方法：</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">export</span> <span class="hljs-function" style="color:#DCDCDC;line-height:26px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">function</span> <span class="hljs-title" style="color:#DCDCDC;line-height:26px;">callHook</span> (<span class="hljs-params" style="color:#DCDCDC;line-height:26px;">vm: Component, hook: string</span>) </span>{
<span></span>  <span class="hljs-comment" style="color:#57A64A;font-style:italic;line-height:26px;">// #7573 disable dep collection when invoking lifecycle hooks</span>
<span></span>  pushTarget()
<span></span>  <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">const</span> handlers = vm.$options[hook]
<span></span>  <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">if</span> (handlers) {
<span></span>    <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">for</span> (<span class="hljs-keyword" style="color:#569CD6;line-height:26px;">let</span> i = <span class="hljs-number" style="color:#B8D7A3;line-height:26px;">0</span>, j = handlers.length; i &lt; j; i++) {
<span></span>      <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">try</span> {
<span></span>        handlers[i].call(vm)
<span></span>      } <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">catch</span> (e) {
<span></span>        handleError(e, vm, <span class="hljs-string" style="color:#D69D85;line-height:26px;">`<span class="hljs-subst" style="color:#DCDCDC;line-height:26px;">${hook}</span> hook`</span>)
<span></span>      }
<span></span>    }
<span></span>  }
<span></span>  <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">if</span> (vm._hasHookEvent) {
<span></span>    vm.$emit(<span class="hljs-string" style="color:#D69D85;line-height:26px;">'hook:'</span> + hook)
<span></span>  }
<span></span>  popTarget()
<span></span>}
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;"><code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">callhook()</code>函数接收两个参数：</p> <ul data-tool="mdnice编辑器" style="margin-top:8px;margin-bottom:8px;padding-left:25px;font-size:15px;color:#595959;list-style-type:circle;"><li><section style="margin-top:5px;margin-bottom:5px;line-height:26px;text-align:left;font-size:14px;font-weight:normal;color:#595959;">实例对象；</section></li><li><section style="margin-top:5px;margin-bottom:5px;line-height:26px;text-align:left;font-size:14px;font-weight:normal;color:#595959;">要调用的生命周期钩子的名称；</section></li></ul> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">首先缓存生命周期函数：</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">const</span> handlers = vm.$options[hook]
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">如果执行 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">callHook(vm, created)</code>，那么就相当于：</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">const</span> handlers = vm.$options.created
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">刚刚介绍过，对于生命周期钩子选项最终会被合并处理成一个数组，所以得到的<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">handlers</code>就是一个生命周期钩子的数组。接着执行的是这段代码：</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">if</span> (handlers) {
<span></span>  <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">for</span> (<span class="hljs-keyword" style="color:#569CD6;line-height:26px;">let</span> i = <span class="hljs-number" style="color:#B8D7A3;line-height:26px;">0</span>, j = handlers.length; i &lt; j; i++) {
<span></span>    <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">try</span> {
<span></span>      handlers[i].call(vm)
<span></span>    } <span class="hljs-keyword" style="color:#569CD6;line-height:26px;">catch</span> (e) {
<span></span>      handleError(e, vm, <span class="hljs-string" style="color:#D69D85;line-height:26px;">`<span class="hljs-subst" style="color:#DCDCDC;line-height:26px;">${hook}</span> hook`</span>)
<span></span>    }
<span></span>  }
<span></span>}
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">最后注意到 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">callHook</code> 函数的最后有这样一段代码：</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;"><span class="hljs-keyword" style="color:#569CD6;line-height:26px;">if</span> (vm._hasHookEvent) {
<span></span>  vm.$emit(<span class="hljs-string" style="color:#D69D85;line-height:26px;">'hook:'</span> + hook)
<span></span>}
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">其中 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">vm._hasHookEvent</code> 是在<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">initEvents</code>函数中定义的，它的作用是判断是否存在<strong style="color:#595959;font-weight:bold;"><span>「</span>生命周期钩子的事件侦听器<span>」</span></strong>，初始化值为 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">false</code> 代表没有，当组件检测到存在生命周期钩子的事件侦听器时，会将<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">vm._hasHookEvent</code>设置为 <code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">true</code>。</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">生命周期钩子的事件侦听器，就是开头说的：</p> <pre data-tool="mdnice编辑器" class="custom" style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display:block;background:url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#1E1E1E;margin-bottom:-7px;border-radius:5px;background-position:10px 10px;"></span><code class="hljs" style="overflow-x:auto;padding:16px;color:#DCDCDC;display:block;font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;font-size:12px;-webkit-overflow-scrolling:touch;padding-top:15px;background:#1E1E1E;border-radius:5px;"><span class="hljs-tag" style="color:#9B9B9B;line-height:26px;">&lt;<span class="hljs-name" style="color:#569CD6;line-height:26px;">child</span>
<span></span>  @<span class="hljs-attr" style="color:#9CDCFE;line-height:26px;">hook:created</span>=<span class="hljs-string" style="color:#D69D85;line-height:26px;">&quot;childCreated&quot;</span>
<span></span>  @<span class="hljs-attr" style="color:#9CDCFE;line-height:26px;">hook:mounted</span>=<span class="hljs-string" style="color:#D69D85;line-height:26px;">&quot;childMounted&quot;</span>
<span></span> /&gt;</span>
<span></span></code></pre> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">使用<code style="font-size:14px;word-wrap:break-word;padding:2px 4px;border-radius:4px;margin:0 2px;background-color:rgba(27,31,35,.05);font-family:Operator Mono, Consolas, Monaco, Menlo, monospace;word-break:break-all;color:#595959;">hook:</code>加生命周期钩子名称的方式来监听组件相应的生命周期钩子。</p> <h2 data-tool="mdnice编辑器" style="margin-top:30px;margin-bottom:15px;padding:0px;font-weight:bold;color:black;font-size:22px;text-align:left;margin:20px 10px 0px 0px;"><span class="prefix" style="display:none;"></span><span class="content" style="font-size:18px;font-weight:bold;display:inline-block;padding-left:10px;border-left:5px solid #DEC6FB;color:#595959;">总结</span><span class="suffix"></span></h2> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">1、子组件data选项函数是有参数的，而且是当前的实例对象；</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">2、生命周期钩子是可以写成数组形式，按顺序执行；</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;">3、可以使用生命周期钩子的事件侦听器来注册生命周期函数</p> <p data-tool="mdnice编辑器" style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#595959;margin:10px 0px;letter-spacing:2px;font-size:14px;word-spacing:2px;"><strong style="color:#595959;font-weight:bold;"><span>「</span>不过没在官方文档中写明的方法，不建议使用<span>」</span></strong>。</p> <h2 data-tool="mdnice编辑器" style="margin-top:30px;margin-bottom:15px;padding:0px;font-weight:bold;color:black;font-size:22px;text-align:left;margin:20px 10px 0px 0px;"><span class="prefix" style="display:none;"></span><span class="content" style="font-size:18px;font-weight:bold;display:inline-block;padding-left:10px;border-left:5px solid #DEC6FB;color:#595959;">结尾</span><span class="suffix"></span></h2></section></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/FEBlog/assets/js/app.b158500d.js" defer></script><script src="/FEBlog/assets/js/2.7d7fb6cb.js" defer></script><script src="/FEBlog/assets/js/45.ad1d828c.js" defer></script>
  </body>
</html>
